# 入口和出口的最佳实践 {ignore}

上节课讲了入口和出口的配置，那么项目中应该怎么配置呢？

没有固定答案，需要具体情况具体分析。

*wepack* 难点在于如何去用，*vue* 和 *react* 框架已经提供了最佳实践方案。那么学习 *webpack* 的意义在哪呢？

主要是为了理解这些框架到底是怎么工作的，怎么运行的。

这节课的意义在于让我们了解大致 *webpack* 是怎么用的，有了一个初步的认识，对之前的知识进行巩固和复习。

下面是一些经典场景

## 一个页面一个JS

![](https://qwq9527.gitee.io/resource/imgs//2020-01-10-12-00-28.png)

源码结构大致这样，这里只列出页面的启动模块。

```
|—— src
    |—— pageA   页面A的代码目录
        |—— index.js 页面A的启动模块
        |—— ...
    |—— pageB   页面B的代码目录
        |—— index.js 页面B的启动模块
        |—— ...
    |—— pageC   页面C的代码目录
        |—— main1.js 页面C的启动模块1 例如：主功能
        |—— main2.js 页面C的启动模块2 例如：实现访问统计的额外功能
        |—— ...
    |—— common  公共代码目录
        |—— ...
```

*页面C*有一个额外的统计功能，*common* 模块提供公共代码，*页面A、B、C* 都会用到，大致这个情况。

webpack配置

```js
module.exports = {
    entry:{
        pageA: "./src/pageA/index.js",
        pageB: "./src/pageB/index.js",
        pageC: ["./src/pageC/main1.js", "./src/pageC/main2.js"]
    },
    output:{
        filename:"[name].[chunkhash:5].js"
    }
}
```

这种方式适用于**页面之间的功能差异巨大**、**公共代码较少的情况**，这种情况下打包出来的最终代码不会有太多重复。

差异巨大值指的是：比如 *页面A* 是抽奖页面，*页面C* 是新闻页面，两个页面基本不相干，没啥复用功能。

公共代码较少：有个问题，这3个文件都有公共代码，**这些公共代码会造成什么影响**？

不好维护，要导出改动？不存在的，这里*js*文件是打包的结果，只需要维护一份源码即可。那会造成什么影响？

导致传输量增加的问题。比如先后访问这三个页面，每个页面对应的 *js* 里面都有重复的代码。例如：

```tex
公共代码：4KB
页面A: 10kB + 4KB
页面B: 10kB + 4KB
页面C: 10kB + 4KB
```

总共：`14*3=42KB`，如果想办法将公共代码抽离出成一个文件，*页面A* 引入两个代码，一个是重复代码，另一个是自己的代码。

最终总共有`34KB`的代码，虽然每个页面引入的代码不变，但是重复代码会缓存下来。

重复的代码越多，对传输量影响越大。所以说这种情况只能适用于重复代码比较少的情况。

那么重复代码多怎么解决呢？需要看后续的优化章节。

那么能不能使用多入模块入口进行打包呢？

也不行，根据上一章内容，多模块入口只是分析依赖关系，最终打包代码一个函数内运行，页面的代码用不到这个模块的变量。

## 一个页面多个JS

额，这张图不是有重复代码吗？一个*js*被两个页面都引入了？

这里情况不一样！往下看源码结构。

![](https://qwq9527.gitee.io/resource/imgs//2020-01-10-12-38-03.png)

源码结构

```
|—— src
    |—— pageA   页面A的代码目录
        |—— index.js 页面A的启动模块
        |—— ...
    |—— pageB   页面B的代码目录
        |—— index.js 页面B的启动模块
        |—— ...
    |—— statistics   用于统计访问人数功能目录
        |—— index.js 启动模块
        |—— ...
    |—— common  公共代码目录
        |—— ...
```

这里多了一个 *statistics* 模块，这个模块的功能和两个页面不相关，是独立的。这种情况下的代码可以单独开一个 *chunk* 提取出去。

当然也有可能用到公共模块代码，统计的时候可能需要用到辅助函数，两个页面也可能会用到。

我们说的是，根据入口，如果这个入口分析出来一大堆模块依赖，其中有些是*common*模块，目前(*章节*)是提取不出去的。

如果两个模块毫不相干，那么这种情况可以提取出去，怎么提取，看下面配置。

webpack配置

```js
module.exports = {
    entry:{
        pageA: "./src/pageA/index.js",
        pageB: "./src/pageB/index.js",
        statistics: "./src/statistics/index.js"
    },
    output:{
        filename:"[name].[chunkhash:5].js"
    }
}
```

这种方式适用于页面之间有一些**独立**、相同的功能，专门使用一个chunk抽离这部分JS有利于浏览器更好的缓存这部分内容。

> 思考：为什么不使用多启动模块的方式？
>
> 这样做是可以的，但是会增加传输量，重复代码每个页面的*js*都在存在，浏览器无法缓存。

## 单页应用

所谓单页应用，是指整个网站（或网站的某一个功能块）只有一个页面，页面中的内容全部靠JS创建和控制。 vue和react都是实现单页应用的利器。

![](https://qwq9527.gitee.io/resource/imgs//2020-01-10-12-44-13.png)

源码结构

```
|—— src
    |—— subFunc   子功能目录
        |—— ...
    |—— subFunc   子功能目录
        |—— ...
    |—— common  公共代码目录
        |—— ...
    |—— index.js
```

webpack配置

```js
module.exports = {
    entry: "./src/index.js",
    output:{
        filename:"index.[hash:5].js"
    }
}
```

