# 数据链路层

Hub采取的是广播的模式，如果每一台电脑发出的包，宿舍的每个电脑都能收到，那就麻烦了。I
**三个问题需要解决**

1. 这个包是发给谁的？谁应该接收？

2. 大家都在发，会不会产生混乱？有没有谁先发、谁后发的规则？

3. 如果发送的时候出现了错误，怎么办？

   

这几个问题，都是第二层，数据链路层，也即MAC层要解决的问题。MAC 的全称是 **Medium Access**
**Control**，即**媒体访问控制**。

控制什么呢？其实就是控制在往媒体上发数据的时候，谁先发、谁后发的问题。防止发生混乱。这解决
的是第二个问题。

方式一：分多个车道。每个车一个车道，你走你的，我走我的。**这在计算机网络里叫作信道划分**；

方式二：今天单号出行，明天双号出行，轮着来。这在计算机网络里叫作**轮流协议**；

方式三：不管三七二十一，有事儿先出门，发现特堵，就回去。错过高峰再出。我们叫作**随机接入协**
**议。著名的以太网，用的就是这个方式**。



接下来要解决第一个问题：发给谁，谁接收？这里用到一个物理地址，叫作**链路层地址**。但是因为第二层主要解决媒体接入控制的问题，所以它常被称为MAC地址。

解决第一个问题就牵扯到第二层的网络包格式。对于以太网，第二层的最开始，就是目标的MAC地址
和源的MAC地址。

![1701676204598](https://qwq9527.gitee.io/resource/imgs/1701676204598.png)

**接下来是类型，大部分的类型是P数据包**，然后P里面包含TCP、UDP,以及HTTP等，这都是里层
封装的事情。

**对于以太网，第二层的最后面是CRC**,也就是循环冗余检测。通过XOR异或的算法，来计算整个包是
否在发送的过程中出现了错误，主要解决第三个问题。

这里还有一个没有解决的问题，当源机器知道目标机器的时候，可以将目标地址放入包里面，如果不知
道呢？一个广播的网络里面接入了N台机器，我怎么知道每个MAC地址是谁呢？**这就是ARP协议，也**
**就是已知P地址，求MAC地址的协议**。

现在路由器是很智能的，可以对ARP进行缓存。

```js
ARP协议就是在局域网里面，吼一句，IP xxx,XXX,XXX,XXX 你的MAC地址是啥，马上告诉我？
然后路由器就会告诉你。
```

![1701676455427](https://qwq9527.gitee.io/resource/imgs/1701676455427.png)
