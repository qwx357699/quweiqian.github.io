<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IndexedDB | 以学愈愚</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/quweiqian/assets/css/0.styles.e8fe9d41.css" as="style"><link rel="preload" href="/quweiqian/assets/js/app.d9b1c135.js" as="script"><link rel="preload" href="/quweiqian/assets/js/4.af0a715f.js" as="script"><link rel="preload" href="/quweiqian/assets/js/220.044f1fd7.js" as="script"><link rel="prefetch" href="/quweiqian/assets/js/10.aad282e2.js"><link rel="prefetch" href="/quweiqian/assets/js/100.03ab11b6.js"><link rel="prefetch" href="/quweiqian/assets/js/101.87d06b4e.js"><link rel="prefetch" href="/quweiqian/assets/js/102.afdae234.js"><link rel="prefetch" href="/quweiqian/assets/js/103.4b1ac115.js"><link rel="prefetch" href="/quweiqian/assets/js/104.bfc7fe84.js"><link rel="prefetch" href="/quweiqian/assets/js/105.1bb460f1.js"><link rel="prefetch" href="/quweiqian/assets/js/106.36b4ec77.js"><link rel="prefetch" href="/quweiqian/assets/js/107.21425eb5.js"><link rel="prefetch" href="/quweiqian/assets/js/108.9bf8dfe0.js"><link rel="prefetch" href="/quweiqian/assets/js/109.b0cc4a29.js"><link rel="prefetch" href="/quweiqian/assets/js/11.f4161a13.js"><link rel="prefetch" href="/quweiqian/assets/js/110.760e54ba.js"><link rel="prefetch" href="/quweiqian/assets/js/111.7430c4d6.js"><link rel="prefetch" href="/quweiqian/assets/js/112.8e2fb502.js"><link rel="prefetch" href="/quweiqian/assets/js/113.b0586013.js"><link rel="prefetch" href="/quweiqian/assets/js/114.485412ea.js"><link rel="prefetch" href="/quweiqian/assets/js/115.931c401b.js"><link rel="prefetch" href="/quweiqian/assets/js/116.434b9421.js"><link rel="prefetch" href="/quweiqian/assets/js/117.c7a94d71.js"><link rel="prefetch" href="/quweiqian/assets/js/118.d15f63d1.js"><link rel="prefetch" href="/quweiqian/assets/js/119.e523970c.js"><link rel="prefetch" href="/quweiqian/assets/js/12.56888aa4.js"><link rel="prefetch" href="/quweiqian/assets/js/120.4ee14159.js"><link rel="prefetch" href="/quweiqian/assets/js/121.0291fa79.js"><link rel="prefetch" href="/quweiqian/assets/js/122.13008c19.js"><link rel="prefetch" href="/quweiqian/assets/js/123.29745a6a.js"><link rel="prefetch" href="/quweiqian/assets/js/124.d0356ed1.js"><link rel="prefetch" href="/quweiqian/assets/js/125.af9c274c.js"><link rel="prefetch" href="/quweiqian/assets/js/126.35dbb44a.js"><link rel="prefetch" href="/quweiqian/assets/js/127.39fd9418.js"><link rel="prefetch" href="/quweiqian/assets/js/128.a10db9de.js"><link rel="prefetch" href="/quweiqian/assets/js/129.2bc4869f.js"><link rel="prefetch" href="/quweiqian/assets/js/13.92890eb4.js"><link rel="prefetch" href="/quweiqian/assets/js/130.ca8cd39b.js"><link rel="prefetch" href="/quweiqian/assets/js/131.05c6b270.js"><link rel="prefetch" href="/quweiqian/assets/js/132.0f48dc0a.js"><link rel="prefetch" href="/quweiqian/assets/js/133.cfd900c6.js"><link rel="prefetch" href="/quweiqian/assets/js/134.53784ffa.js"><link rel="prefetch" href="/quweiqian/assets/js/135.a4402e04.js"><link rel="prefetch" href="/quweiqian/assets/js/136.6e75945a.js"><link rel="prefetch" href="/quweiqian/assets/js/137.a109ae97.js"><link rel="prefetch" href="/quweiqian/assets/js/138.34a4b91c.js"><link rel="prefetch" href="/quweiqian/assets/js/139.703512f4.js"><link rel="prefetch" href="/quweiqian/assets/js/14.b4de3754.js"><link rel="prefetch" href="/quweiqian/assets/js/140.6b51a71c.js"><link rel="prefetch" href="/quweiqian/assets/js/141.f9a10134.js"><link rel="prefetch" href="/quweiqian/assets/js/142.83bfdd98.js"><link rel="prefetch" href="/quweiqian/assets/js/143.db0ffb47.js"><link rel="prefetch" href="/quweiqian/assets/js/144.74fbcce0.js"><link rel="prefetch" href="/quweiqian/assets/js/145.e5607d74.js"><link rel="prefetch" href="/quweiqian/assets/js/146.0b7b36df.js"><link rel="prefetch" href="/quweiqian/assets/js/147.4165c2a3.js"><link rel="prefetch" href="/quweiqian/assets/js/148.5e1943e8.js"><link rel="prefetch" href="/quweiqian/assets/js/149.5fd13171.js"><link rel="prefetch" href="/quweiqian/assets/js/15.4aab028c.js"><link rel="prefetch" href="/quweiqian/assets/js/150.c3c39fc0.js"><link rel="prefetch" href="/quweiqian/assets/js/151.94f4b52b.js"><link rel="prefetch" href="/quweiqian/assets/js/152.78d49c21.js"><link rel="prefetch" href="/quweiqian/assets/js/153.01ad5069.js"><link rel="prefetch" href="/quweiqian/assets/js/154.a3e68d9d.js"><link rel="prefetch" href="/quweiqian/assets/js/155.22924788.js"><link rel="prefetch" href="/quweiqian/assets/js/156.e8c31157.js"><link rel="prefetch" href="/quweiqian/assets/js/157.da225012.js"><link rel="prefetch" href="/quweiqian/assets/js/158.77b0bdaa.js"><link rel="prefetch" href="/quweiqian/assets/js/159.a2073fc8.js"><link rel="prefetch" href="/quweiqian/assets/js/16.45f5574e.js"><link rel="prefetch" href="/quweiqian/assets/js/160.554856d2.js"><link rel="prefetch" href="/quweiqian/assets/js/161.7a27221b.js"><link rel="prefetch" href="/quweiqian/assets/js/162.ac307ab8.js"><link rel="prefetch" href="/quweiqian/assets/js/163.4d6e8289.js"><link rel="prefetch" href="/quweiqian/assets/js/164.9b9c52f4.js"><link rel="prefetch" href="/quweiqian/assets/js/165.6e1e29ac.js"><link rel="prefetch" href="/quweiqian/assets/js/166.1e22ffd6.js"><link rel="prefetch" href="/quweiqian/assets/js/167.d056fd24.js"><link rel="prefetch" href="/quweiqian/assets/js/168.b978e6bd.js"><link rel="prefetch" href="/quweiqian/assets/js/169.db3a6db3.js"><link rel="prefetch" href="/quweiqian/assets/js/17.c1be60e3.js"><link rel="prefetch" href="/quweiqian/assets/js/170.70692718.js"><link rel="prefetch" href="/quweiqian/assets/js/171.7fbc11c0.js"><link rel="prefetch" href="/quweiqian/assets/js/172.e3591800.js"><link rel="prefetch" href="/quweiqian/assets/js/173.427c2c0c.js"><link rel="prefetch" href="/quweiqian/assets/js/174.413b3674.js"><link rel="prefetch" href="/quweiqian/assets/js/175.b869da99.js"><link rel="prefetch" href="/quweiqian/assets/js/176.e05a6267.js"><link rel="prefetch" href="/quweiqian/assets/js/177.0f5c13ab.js"><link rel="prefetch" href="/quweiqian/assets/js/178.a7b59e23.js"><link rel="prefetch" href="/quweiqian/assets/js/179.b347ae4f.js"><link rel="prefetch" href="/quweiqian/assets/js/18.6bb20029.js"><link rel="prefetch" href="/quweiqian/assets/js/180.756e811b.js"><link rel="prefetch" href="/quweiqian/assets/js/181.db196afa.js"><link rel="prefetch" href="/quweiqian/assets/js/182.b86e2414.js"><link rel="prefetch" href="/quweiqian/assets/js/183.dde54826.js"><link rel="prefetch" href="/quweiqian/assets/js/184.ba3bae91.js"><link rel="prefetch" href="/quweiqian/assets/js/185.e52ee357.js"><link rel="prefetch" href="/quweiqian/assets/js/186.dceb6413.js"><link rel="prefetch" href="/quweiqian/assets/js/187.828171fe.js"><link rel="prefetch" href="/quweiqian/assets/js/188.20f2aad3.js"><link rel="prefetch" href="/quweiqian/assets/js/189.2e247e03.js"><link rel="prefetch" href="/quweiqian/assets/js/19.3d298cbc.js"><link rel="prefetch" href="/quweiqian/assets/js/190.e52900f3.js"><link rel="prefetch" href="/quweiqian/assets/js/191.2a535769.js"><link rel="prefetch" href="/quweiqian/assets/js/192.7d5f0ef6.js"><link rel="prefetch" href="/quweiqian/assets/js/193.f8952e84.js"><link rel="prefetch" href="/quweiqian/assets/js/194.c8f72708.js"><link rel="prefetch" href="/quweiqian/assets/js/195.3d7c07a2.js"><link rel="prefetch" href="/quweiqian/assets/js/196.464fd8e5.js"><link rel="prefetch" href="/quweiqian/assets/js/197.4fbd57a9.js"><link rel="prefetch" href="/quweiqian/assets/js/198.24464abb.js"><link rel="prefetch" href="/quweiqian/assets/js/199.5dc82dd6.js"><link rel="prefetch" href="/quweiqian/assets/js/2.298a66d4.js"><link rel="prefetch" href="/quweiqian/assets/js/20.c17b9d12.js"><link rel="prefetch" href="/quweiqian/assets/js/200.f5b5f591.js"><link rel="prefetch" href="/quweiqian/assets/js/201.92d34968.js"><link rel="prefetch" href="/quweiqian/assets/js/202.7ecd99e5.js"><link rel="prefetch" href="/quweiqian/assets/js/203.4526d859.js"><link rel="prefetch" href="/quweiqian/assets/js/204.261553f2.js"><link rel="prefetch" href="/quweiqian/assets/js/205.be663d09.js"><link rel="prefetch" href="/quweiqian/assets/js/206.1d4830c2.js"><link rel="prefetch" href="/quweiqian/assets/js/207.f4fb91f4.js"><link rel="prefetch" href="/quweiqian/assets/js/208.41fbc955.js"><link rel="prefetch" href="/quweiqian/assets/js/209.25980427.js"><link rel="prefetch" href="/quweiqian/assets/js/21.1e0736fc.js"><link rel="prefetch" href="/quweiqian/assets/js/210.3afa816d.js"><link rel="prefetch" href="/quweiqian/assets/js/211.800dd2ef.js"><link rel="prefetch" href="/quweiqian/assets/js/212.acb247e6.js"><link rel="prefetch" href="/quweiqian/assets/js/213.79ae570e.js"><link rel="prefetch" href="/quweiqian/assets/js/214.495a9247.js"><link rel="prefetch" href="/quweiqian/assets/js/215.d0e046c1.js"><link rel="prefetch" href="/quweiqian/assets/js/216.1f733f75.js"><link rel="prefetch" href="/quweiqian/assets/js/217.953b4e42.js"><link rel="prefetch" href="/quweiqian/assets/js/218.8fd80b19.js"><link rel="prefetch" href="/quweiqian/assets/js/219.09a9ca08.js"><link rel="prefetch" href="/quweiqian/assets/js/22.92e3f355.js"><link rel="prefetch" href="/quweiqian/assets/js/221.30e2eb39.js"><link rel="prefetch" href="/quweiqian/assets/js/222.04933c9f.js"><link rel="prefetch" href="/quweiqian/assets/js/223.4e04453e.js"><link rel="prefetch" href="/quweiqian/assets/js/224.8460466b.js"><link rel="prefetch" href="/quweiqian/assets/js/225.2cbfb0a0.js"><link rel="prefetch" href="/quweiqian/assets/js/226.22603a1a.js"><link rel="prefetch" href="/quweiqian/assets/js/227.7612da61.js"><link rel="prefetch" href="/quweiqian/assets/js/228.613cbf82.js"><link rel="prefetch" href="/quweiqian/assets/js/229.10746da1.js"><link rel="prefetch" href="/quweiqian/assets/js/23.650926b6.js"><link rel="prefetch" href="/quweiqian/assets/js/230.f4779578.js"><link rel="prefetch" href="/quweiqian/assets/js/231.cd7b6fb8.js"><link rel="prefetch" href="/quweiqian/assets/js/232.3080ea96.js"><link rel="prefetch" href="/quweiqian/assets/js/233.0fdc31c1.js"><link rel="prefetch" href="/quweiqian/assets/js/234.e1b52d54.js"><link rel="prefetch" href="/quweiqian/assets/js/235.9a2da052.js"><link rel="prefetch" href="/quweiqian/assets/js/236.194147c5.js"><link rel="prefetch" href="/quweiqian/assets/js/237.7d771c11.js"><link rel="prefetch" href="/quweiqian/assets/js/238.f8e25d8d.js"><link rel="prefetch" href="/quweiqian/assets/js/239.2aebae91.js"><link rel="prefetch" href="/quweiqian/assets/js/24.d321e109.js"><link rel="prefetch" href="/quweiqian/assets/js/240.6b08682e.js"><link rel="prefetch" href="/quweiqian/assets/js/241.2ba3c24b.js"><link rel="prefetch" href="/quweiqian/assets/js/242.a39f0108.js"><link rel="prefetch" href="/quweiqian/assets/js/243.ff965eae.js"><link rel="prefetch" href="/quweiqian/assets/js/244.5062f3bc.js"><link rel="prefetch" href="/quweiqian/assets/js/245.bdbbfa94.js"><link rel="prefetch" href="/quweiqian/assets/js/246.1cd81e91.js"><link rel="prefetch" href="/quweiqian/assets/js/247.13a9716b.js"><link rel="prefetch" href="/quweiqian/assets/js/248.db42a805.js"><link rel="prefetch" href="/quweiqian/assets/js/249.672801e2.js"><link rel="prefetch" href="/quweiqian/assets/js/25.4af130a3.js"><link rel="prefetch" href="/quweiqian/assets/js/250.711c8668.js"><link rel="prefetch" href="/quweiqian/assets/js/251.07173c24.js"><link rel="prefetch" href="/quweiqian/assets/js/252.5ad8acb3.js"><link rel="prefetch" href="/quweiqian/assets/js/253.51fbdf5d.js"><link rel="prefetch" href="/quweiqian/assets/js/254.4afe8a36.js"><link rel="prefetch" href="/quweiqian/assets/js/255.384c6e75.js"><link rel="prefetch" href="/quweiqian/assets/js/256.b4501f21.js"><link rel="prefetch" href="/quweiqian/assets/js/257.db1d3812.js"><link rel="prefetch" href="/quweiqian/assets/js/258.82142458.js"><link rel="prefetch" href="/quweiqian/assets/js/259.e1313a09.js"><link rel="prefetch" href="/quweiqian/assets/js/26.50433bc8.js"><link rel="prefetch" href="/quweiqian/assets/js/260.522f2f9e.js"><link rel="prefetch" href="/quweiqian/assets/js/261.05618f95.js"><link rel="prefetch" href="/quweiqian/assets/js/262.2889c042.js"><link rel="prefetch" href="/quweiqian/assets/js/263.b4b90e5d.js"><link rel="prefetch" href="/quweiqian/assets/js/264.9100f015.js"><link rel="prefetch" href="/quweiqian/assets/js/265.bc597649.js"><link rel="prefetch" href="/quweiqian/assets/js/266.9df19886.js"><link rel="prefetch" href="/quweiqian/assets/js/267.bd141c03.js"><link rel="prefetch" href="/quweiqian/assets/js/268.35eb2eb4.js"><link rel="prefetch" href="/quweiqian/assets/js/269.3cf1baab.js"><link rel="prefetch" href="/quweiqian/assets/js/27.494162f0.js"><link rel="prefetch" href="/quweiqian/assets/js/270.8c8d9dc1.js"><link rel="prefetch" href="/quweiqian/assets/js/271.2cba303f.js"><link rel="prefetch" href="/quweiqian/assets/js/272.e8aafbf4.js"><link rel="prefetch" href="/quweiqian/assets/js/273.86412ff8.js"><link rel="prefetch" href="/quweiqian/assets/js/274.a8bd36a1.js"><link rel="prefetch" href="/quweiqian/assets/js/275.be3f605e.js"><link rel="prefetch" href="/quweiqian/assets/js/276.41f05b25.js"><link rel="prefetch" href="/quweiqian/assets/js/277.9d7ad493.js"><link rel="prefetch" href="/quweiqian/assets/js/278.0f405e2f.js"><link rel="prefetch" href="/quweiqian/assets/js/279.3e9ac66b.js"><link rel="prefetch" href="/quweiqian/assets/js/28.3ca25dd4.js"><link rel="prefetch" href="/quweiqian/assets/js/280.0367625b.js"><link rel="prefetch" href="/quweiqian/assets/js/281.c2f76ad4.js"><link rel="prefetch" href="/quweiqian/assets/js/282.991705ea.js"><link rel="prefetch" href="/quweiqian/assets/js/283.650d0e06.js"><link rel="prefetch" href="/quweiqian/assets/js/284.4e9182ea.js"><link rel="prefetch" href="/quweiqian/assets/js/285.e148b622.js"><link rel="prefetch" href="/quweiqian/assets/js/286.78d4517f.js"><link rel="prefetch" href="/quweiqian/assets/js/287.064ceb58.js"><link rel="prefetch" href="/quweiqian/assets/js/288.2c395a62.js"><link rel="prefetch" href="/quweiqian/assets/js/289.a1c8a1c5.js"><link rel="prefetch" href="/quweiqian/assets/js/29.0e22c500.js"><link rel="prefetch" href="/quweiqian/assets/js/290.7bd83b14.js"><link rel="prefetch" href="/quweiqian/assets/js/291.c331442e.js"><link rel="prefetch" href="/quweiqian/assets/js/292.bd20aaf6.js"><link rel="prefetch" href="/quweiqian/assets/js/293.f210021a.js"><link rel="prefetch" href="/quweiqian/assets/js/294.c7903fce.js"><link rel="prefetch" href="/quweiqian/assets/js/295.c95f7ba2.js"><link rel="prefetch" href="/quweiqian/assets/js/296.ae3e5cf6.js"><link rel="prefetch" href="/quweiqian/assets/js/297.08c15b47.js"><link rel="prefetch" href="/quweiqian/assets/js/298.c374a4f8.js"><link rel="prefetch" href="/quweiqian/assets/js/299.516ad6a4.js"><link rel="prefetch" href="/quweiqian/assets/js/3.fd207dc3.js"><link rel="prefetch" href="/quweiqian/assets/js/30.3104bdcf.js"><link rel="prefetch" href="/quweiqian/assets/js/300.6d25d090.js"><link rel="prefetch" href="/quweiqian/assets/js/301.d984ede9.js"><link rel="prefetch" href="/quweiqian/assets/js/302.5bbfffa0.js"><link rel="prefetch" href="/quweiqian/assets/js/303.8e81bf5c.js"><link rel="prefetch" href="/quweiqian/assets/js/304.63aca6d8.js"><link rel="prefetch" href="/quweiqian/assets/js/305.5a69e424.js"><link rel="prefetch" href="/quweiqian/assets/js/306.9e445df4.js"><link rel="prefetch" href="/quweiqian/assets/js/307.43b2a1d9.js"><link rel="prefetch" href="/quweiqian/assets/js/308.44d27f5a.js"><link rel="prefetch" href="/quweiqian/assets/js/309.b4e4e0ca.js"><link rel="prefetch" href="/quweiqian/assets/js/31.d280f8ef.js"><link rel="prefetch" href="/quweiqian/assets/js/310.86443928.js"><link rel="prefetch" href="/quweiqian/assets/js/311.1eb8ef04.js"><link rel="prefetch" href="/quweiqian/assets/js/312.50d09e7f.js"><link rel="prefetch" href="/quweiqian/assets/js/313.7c730f27.js"><link rel="prefetch" href="/quweiqian/assets/js/314.fa45e3b9.js"><link rel="prefetch" href="/quweiqian/assets/js/315.7ac99b46.js"><link rel="prefetch" href="/quweiqian/assets/js/316.b58a5c59.js"><link rel="prefetch" href="/quweiqian/assets/js/317.aeeef222.js"><link rel="prefetch" href="/quweiqian/assets/js/318.52aff5a4.js"><link rel="prefetch" href="/quweiqian/assets/js/319.28ff332c.js"><link rel="prefetch" href="/quweiqian/assets/js/32.da65b699.js"><link rel="prefetch" href="/quweiqian/assets/js/320.6703fc16.js"><link rel="prefetch" href="/quweiqian/assets/js/321.cb6e0999.js"><link rel="prefetch" href="/quweiqian/assets/js/322.c26a5dd5.js"><link rel="prefetch" href="/quweiqian/assets/js/323.713cd65d.js"><link rel="prefetch" href="/quweiqian/assets/js/324.e91506c4.js"><link rel="prefetch" href="/quweiqian/assets/js/325.25100785.js"><link rel="prefetch" href="/quweiqian/assets/js/326.eb2f4a10.js"><link rel="prefetch" href="/quweiqian/assets/js/327.deffaaf5.js"><link rel="prefetch" href="/quweiqian/assets/js/328.23e67c20.js"><link rel="prefetch" href="/quweiqian/assets/js/329.b9df454d.js"><link rel="prefetch" href="/quweiqian/assets/js/33.f07b2711.js"><link rel="prefetch" href="/quweiqian/assets/js/330.5dbb3113.js"><link rel="prefetch" href="/quweiqian/assets/js/331.0374447c.js"><link rel="prefetch" href="/quweiqian/assets/js/332.a955c1f9.js"><link rel="prefetch" href="/quweiqian/assets/js/333.cb07d48b.js"><link rel="prefetch" href="/quweiqian/assets/js/334.7d896394.js"><link rel="prefetch" href="/quweiqian/assets/js/335.c3bcfc06.js"><link rel="prefetch" href="/quweiqian/assets/js/336.38fbf794.js"><link rel="prefetch" href="/quweiqian/assets/js/337.e03e7f4c.js"><link rel="prefetch" href="/quweiqian/assets/js/338.18a0f69a.js"><link rel="prefetch" href="/quweiqian/assets/js/339.519f0274.js"><link rel="prefetch" href="/quweiqian/assets/js/34.bed36776.js"><link rel="prefetch" href="/quweiqian/assets/js/340.204844f0.js"><link rel="prefetch" href="/quweiqian/assets/js/341.953a2156.js"><link rel="prefetch" href="/quweiqian/assets/js/342.2e875daa.js"><link rel="prefetch" href="/quweiqian/assets/js/343.56c44f4a.js"><link rel="prefetch" href="/quweiqian/assets/js/344.c7c7e064.js"><link rel="prefetch" href="/quweiqian/assets/js/345.12254227.js"><link rel="prefetch" href="/quweiqian/assets/js/346.6bcb1dc3.js"><link rel="prefetch" href="/quweiqian/assets/js/347.c6ccd769.js"><link rel="prefetch" href="/quweiqian/assets/js/348.1af46648.js"><link rel="prefetch" href="/quweiqian/assets/js/349.1ac5b7e8.js"><link rel="prefetch" href="/quweiqian/assets/js/35.858df7f1.js"><link rel="prefetch" href="/quweiqian/assets/js/350.5db6ca71.js"><link rel="prefetch" href="/quweiqian/assets/js/351.70ac7e42.js"><link rel="prefetch" href="/quweiqian/assets/js/352.7a0f3749.js"><link rel="prefetch" href="/quweiqian/assets/js/353.699e3ca8.js"><link rel="prefetch" href="/quweiqian/assets/js/354.47ea13a1.js"><link rel="prefetch" href="/quweiqian/assets/js/355.23eaf377.js"><link rel="prefetch" href="/quweiqian/assets/js/356.d850cb7a.js"><link rel="prefetch" href="/quweiqian/assets/js/357.d9610bbb.js"><link rel="prefetch" href="/quweiqian/assets/js/358.5df877e5.js"><link rel="prefetch" href="/quweiqian/assets/js/359.7ce1290b.js"><link rel="prefetch" href="/quweiqian/assets/js/36.ddb8eb30.js"><link rel="prefetch" href="/quweiqian/assets/js/360.b912ae57.js"><link rel="prefetch" href="/quweiqian/assets/js/361.1ffef6eb.js"><link rel="prefetch" href="/quweiqian/assets/js/362.2a037447.js"><link rel="prefetch" href="/quweiqian/assets/js/363.c867eef7.js"><link rel="prefetch" href="/quweiqian/assets/js/364.a1b33023.js"><link rel="prefetch" href="/quweiqian/assets/js/365.ab7611eb.js"><link rel="prefetch" href="/quweiqian/assets/js/366.7ba53739.js"><link rel="prefetch" href="/quweiqian/assets/js/367.ad0b3cb0.js"><link rel="prefetch" href="/quweiqian/assets/js/368.19564a69.js"><link rel="prefetch" href="/quweiqian/assets/js/369.10714bb7.js"><link rel="prefetch" href="/quweiqian/assets/js/37.a97a99c0.js"><link rel="prefetch" href="/quweiqian/assets/js/370.ee2e3bae.js"><link rel="prefetch" href="/quweiqian/assets/js/371.13b16894.js"><link rel="prefetch" href="/quweiqian/assets/js/372.3ad9b64f.js"><link rel="prefetch" href="/quweiqian/assets/js/373.65f05c8b.js"><link rel="prefetch" href="/quweiqian/assets/js/374.5bcf880f.js"><link rel="prefetch" href="/quweiqian/assets/js/375.fb038190.js"><link rel="prefetch" href="/quweiqian/assets/js/376.b7a0eee8.js"><link rel="prefetch" href="/quweiqian/assets/js/377.6eea46e4.js"><link rel="prefetch" href="/quweiqian/assets/js/378.a196b3ef.js"><link rel="prefetch" href="/quweiqian/assets/js/379.a3cd640a.js"><link rel="prefetch" href="/quweiqian/assets/js/38.d4dc3fd1.js"><link rel="prefetch" href="/quweiqian/assets/js/380.8eeb5a0a.js"><link rel="prefetch" href="/quweiqian/assets/js/381.3f5ad787.js"><link rel="prefetch" href="/quweiqian/assets/js/382.f79977a0.js"><link rel="prefetch" href="/quweiqian/assets/js/383.17840e0e.js"><link rel="prefetch" href="/quweiqian/assets/js/384.e0a1e2fd.js"><link rel="prefetch" href="/quweiqian/assets/js/385.babeb16b.js"><link rel="prefetch" href="/quweiqian/assets/js/386.3f1d5e31.js"><link rel="prefetch" href="/quweiqian/assets/js/387.a94d1cab.js"><link rel="prefetch" href="/quweiqian/assets/js/388.c8c48287.js"><link rel="prefetch" href="/quweiqian/assets/js/389.0fdfb7e9.js"><link rel="prefetch" href="/quweiqian/assets/js/39.83777f8a.js"><link rel="prefetch" href="/quweiqian/assets/js/390.4b4660d7.js"><link rel="prefetch" href="/quweiqian/assets/js/391.901d1fa7.js"><link rel="prefetch" href="/quweiqian/assets/js/392.6c53bdb1.js"><link rel="prefetch" href="/quweiqian/assets/js/393.255e7ff1.js"><link rel="prefetch" href="/quweiqian/assets/js/394.8896585e.js"><link rel="prefetch" href="/quweiqian/assets/js/395.2ee91421.js"><link rel="prefetch" href="/quweiqian/assets/js/396.e8b5220c.js"><link rel="prefetch" href="/quweiqian/assets/js/397.cd302ead.js"><link rel="prefetch" href="/quweiqian/assets/js/398.95ce5c5b.js"><link rel="prefetch" href="/quweiqian/assets/js/399.cc1d3470.js"><link rel="prefetch" href="/quweiqian/assets/js/40.6d8ba30e.js"><link rel="prefetch" href="/quweiqian/assets/js/400.c3fd62c7.js"><link rel="prefetch" href="/quweiqian/assets/js/401.7b1115ae.js"><link rel="prefetch" href="/quweiqian/assets/js/402.90003f77.js"><link rel="prefetch" href="/quweiqian/assets/js/403.234771e8.js"><link rel="prefetch" href="/quweiqian/assets/js/404.18f40bff.js"><link rel="prefetch" href="/quweiqian/assets/js/405.23562901.js"><link rel="prefetch" href="/quweiqian/assets/js/406.53288a9e.js"><link rel="prefetch" href="/quweiqian/assets/js/407.2b5ebace.js"><link rel="prefetch" href="/quweiqian/assets/js/408.de3cd013.js"><link rel="prefetch" href="/quweiqian/assets/js/409.422c0165.js"><link rel="prefetch" href="/quweiqian/assets/js/41.5948b634.js"><link rel="prefetch" href="/quweiqian/assets/js/410.aacfa25d.js"><link rel="prefetch" href="/quweiqian/assets/js/411.a784ab71.js"><link rel="prefetch" href="/quweiqian/assets/js/412.a814d1ed.js"><link rel="prefetch" href="/quweiqian/assets/js/413.378560ec.js"><link rel="prefetch" href="/quweiqian/assets/js/414.5348733a.js"><link rel="prefetch" href="/quweiqian/assets/js/415.7e84014e.js"><link rel="prefetch" href="/quweiqian/assets/js/416.4b0fc1c9.js"><link rel="prefetch" href="/quweiqian/assets/js/417.369f7ce9.js"><link rel="prefetch" href="/quweiqian/assets/js/418.d10df012.js"><link rel="prefetch" href="/quweiqian/assets/js/419.b15e651a.js"><link rel="prefetch" href="/quweiqian/assets/js/42.e47cf185.js"><link rel="prefetch" href="/quweiqian/assets/js/420.7999eae0.js"><link rel="prefetch" href="/quweiqian/assets/js/421.ce903c48.js"><link rel="prefetch" href="/quweiqian/assets/js/422.405596a9.js"><link rel="prefetch" href="/quweiqian/assets/js/423.738be32e.js"><link rel="prefetch" href="/quweiqian/assets/js/424.e106f8b7.js"><link rel="prefetch" href="/quweiqian/assets/js/425.b16bc73b.js"><link rel="prefetch" href="/quweiqian/assets/js/426.fc90e02c.js"><link rel="prefetch" href="/quweiqian/assets/js/427.570b2796.js"><link rel="prefetch" href="/quweiqian/assets/js/428.b3e9c8f9.js"><link rel="prefetch" href="/quweiqian/assets/js/429.6d25783c.js"><link rel="prefetch" href="/quweiqian/assets/js/43.61c23d77.js"><link rel="prefetch" href="/quweiqian/assets/js/430.d2f62d06.js"><link rel="prefetch" href="/quweiqian/assets/js/431.e880dd1a.js"><link rel="prefetch" href="/quweiqian/assets/js/432.02808f21.js"><link rel="prefetch" href="/quweiqian/assets/js/433.4c45ceaf.js"><link rel="prefetch" href="/quweiqian/assets/js/434.a1f04c60.js"><link rel="prefetch" href="/quweiqian/assets/js/435.be319d7c.js"><link rel="prefetch" href="/quweiqian/assets/js/436.e6a7abc5.js"><link rel="prefetch" href="/quweiqian/assets/js/437.be5c6986.js"><link rel="prefetch" href="/quweiqian/assets/js/438.cd9caf0c.js"><link rel="prefetch" href="/quweiqian/assets/js/439.1e0fe09b.js"><link rel="prefetch" href="/quweiqian/assets/js/44.c7fd601b.js"><link rel="prefetch" href="/quweiqian/assets/js/440.e0b032a6.js"><link rel="prefetch" href="/quweiqian/assets/js/441.dbb6d7ba.js"><link rel="prefetch" href="/quweiqian/assets/js/442.49e957a4.js"><link rel="prefetch" href="/quweiqian/assets/js/443.0185a5a7.js"><link rel="prefetch" href="/quweiqian/assets/js/444.cf3e4593.js"><link rel="prefetch" href="/quweiqian/assets/js/445.5852644b.js"><link rel="prefetch" href="/quweiqian/assets/js/446.254a45dc.js"><link rel="prefetch" href="/quweiqian/assets/js/447.9e5664b7.js"><link rel="prefetch" href="/quweiqian/assets/js/448.59a5a06b.js"><link rel="prefetch" href="/quweiqian/assets/js/449.bfffed93.js"><link rel="prefetch" href="/quweiqian/assets/js/45.6b1f0c4a.js"><link rel="prefetch" href="/quweiqian/assets/js/450.ec9249a9.js"><link rel="prefetch" href="/quweiqian/assets/js/451.eb80c9e5.js"><link rel="prefetch" href="/quweiqian/assets/js/452.d4de347b.js"><link rel="prefetch" href="/quweiqian/assets/js/453.75a6a36e.js"><link rel="prefetch" href="/quweiqian/assets/js/454.d76be437.js"><link rel="prefetch" href="/quweiqian/assets/js/455.a51c29ac.js"><link rel="prefetch" href="/quweiqian/assets/js/456.eeb0f363.js"><link rel="prefetch" href="/quweiqian/assets/js/457.3a5320ee.js"><link rel="prefetch" href="/quweiqian/assets/js/458.15039b1d.js"><link rel="prefetch" href="/quweiqian/assets/js/459.866663f6.js"><link rel="prefetch" href="/quweiqian/assets/js/46.01cede6c.js"><link rel="prefetch" href="/quweiqian/assets/js/460.58eeeb32.js"><link rel="prefetch" href="/quweiqian/assets/js/461.02f4620d.js"><link rel="prefetch" href="/quweiqian/assets/js/462.79aa6a28.js"><link rel="prefetch" href="/quweiqian/assets/js/463.d63656da.js"><link rel="prefetch" href="/quweiqian/assets/js/464.764930ca.js"><link rel="prefetch" href="/quweiqian/assets/js/465.531e7565.js"><link rel="prefetch" href="/quweiqian/assets/js/466.adf2b0ec.js"><link rel="prefetch" href="/quweiqian/assets/js/467.378f980e.js"><link rel="prefetch" href="/quweiqian/assets/js/468.86366e60.js"><link rel="prefetch" href="/quweiqian/assets/js/469.b8500e84.js"><link rel="prefetch" href="/quweiqian/assets/js/47.a07078f9.js"><link rel="prefetch" href="/quweiqian/assets/js/470.db15e6b5.js"><link rel="prefetch" href="/quweiqian/assets/js/471.536fee35.js"><link rel="prefetch" href="/quweiqian/assets/js/472.f19b75ae.js"><link rel="prefetch" href="/quweiqian/assets/js/473.bc7efa07.js"><link rel="prefetch" href="/quweiqian/assets/js/474.b51a5292.js"><link rel="prefetch" href="/quweiqian/assets/js/475.12133f29.js"><link rel="prefetch" href="/quweiqian/assets/js/476.b1b8b744.js"><link rel="prefetch" href="/quweiqian/assets/js/477.9863f9b8.js"><link rel="prefetch" href="/quweiqian/assets/js/478.832da548.js"><link rel="prefetch" href="/quweiqian/assets/js/479.191774a1.js"><link rel="prefetch" href="/quweiqian/assets/js/48.7f4323bd.js"><link rel="prefetch" href="/quweiqian/assets/js/480.5cd76fc1.js"><link rel="prefetch" href="/quweiqian/assets/js/481.1f573010.js"><link rel="prefetch" href="/quweiqian/assets/js/482.68aa1d7d.js"><link rel="prefetch" href="/quweiqian/assets/js/483.f396532b.js"><link rel="prefetch" href="/quweiqian/assets/js/484.eb0659a0.js"><link rel="prefetch" href="/quweiqian/assets/js/485.302af10f.js"><link rel="prefetch" href="/quweiqian/assets/js/486.e1eda1aa.js"><link rel="prefetch" href="/quweiqian/assets/js/487.c54faf61.js"><link rel="prefetch" href="/quweiqian/assets/js/488.679b7438.js"><link rel="prefetch" href="/quweiqian/assets/js/489.4e06f5a6.js"><link rel="prefetch" href="/quweiqian/assets/js/49.85544d6d.js"><link rel="prefetch" href="/quweiqian/assets/js/490.be1db032.js"><link rel="prefetch" href="/quweiqian/assets/js/491.67c54fac.js"><link rel="prefetch" href="/quweiqian/assets/js/492.c7146c6e.js"><link rel="prefetch" href="/quweiqian/assets/js/493.583df96a.js"><link rel="prefetch" href="/quweiqian/assets/js/494.45c85253.js"><link rel="prefetch" href="/quweiqian/assets/js/495.3caa3060.js"><link rel="prefetch" href="/quweiqian/assets/js/496.f05340d9.js"><link rel="prefetch" href="/quweiqian/assets/js/497.62f89eb6.js"><link rel="prefetch" href="/quweiqian/assets/js/498.0c3dabd7.js"><link rel="prefetch" href="/quweiqian/assets/js/499.ad5bc953.js"><link rel="prefetch" href="/quweiqian/assets/js/5.20428549.js"><link rel="prefetch" href="/quweiqian/assets/js/50.4f0b8f36.js"><link rel="prefetch" href="/quweiqian/assets/js/500.418ad242.js"><link rel="prefetch" href="/quweiqian/assets/js/501.bb8a9e45.js"><link rel="prefetch" href="/quweiqian/assets/js/502.94269728.js"><link rel="prefetch" href="/quweiqian/assets/js/503.4bbe2f5e.js"><link rel="prefetch" href="/quweiqian/assets/js/504.d7b9daf9.js"><link rel="prefetch" href="/quweiqian/assets/js/505.4e24158a.js"><link rel="prefetch" href="/quweiqian/assets/js/506.36e08f78.js"><link rel="prefetch" href="/quweiqian/assets/js/507.5fce5131.js"><link rel="prefetch" href="/quweiqian/assets/js/508.3a337a8e.js"><link rel="prefetch" href="/quweiqian/assets/js/509.550cf303.js"><link rel="prefetch" href="/quweiqian/assets/js/51.5449dc56.js"><link rel="prefetch" href="/quweiqian/assets/js/510.a2619068.js"><link rel="prefetch" href="/quweiqian/assets/js/511.c4355e92.js"><link rel="prefetch" href="/quweiqian/assets/js/512.0fdaad0c.js"><link rel="prefetch" href="/quweiqian/assets/js/513.e8bc87e9.js"><link rel="prefetch" href="/quweiqian/assets/js/514.a17e0ba0.js"><link rel="prefetch" href="/quweiqian/assets/js/515.21b0e2e6.js"><link rel="prefetch" href="/quweiqian/assets/js/516.92fc20f3.js"><link rel="prefetch" href="/quweiqian/assets/js/517.43f42fb2.js"><link rel="prefetch" href="/quweiqian/assets/js/518.937d6e64.js"><link rel="prefetch" href="/quweiqian/assets/js/519.9420d66a.js"><link rel="prefetch" href="/quweiqian/assets/js/52.79b0ef5e.js"><link rel="prefetch" href="/quweiqian/assets/js/520.ca4392e8.js"><link rel="prefetch" href="/quweiqian/assets/js/521.e0fcd089.js"><link rel="prefetch" href="/quweiqian/assets/js/522.83105290.js"><link rel="prefetch" href="/quweiqian/assets/js/523.edcab369.js"><link rel="prefetch" href="/quweiqian/assets/js/524.d82069a9.js"><link rel="prefetch" href="/quweiqian/assets/js/525.6a81294a.js"><link rel="prefetch" href="/quweiqian/assets/js/526.a2aae0b2.js"><link rel="prefetch" href="/quweiqian/assets/js/527.6a548ac2.js"><link rel="prefetch" href="/quweiqian/assets/js/528.622dc1f8.js"><link rel="prefetch" href="/quweiqian/assets/js/529.52db6ea9.js"><link rel="prefetch" href="/quweiqian/assets/js/53.cf418fe3.js"><link rel="prefetch" href="/quweiqian/assets/js/530.09d4aa48.js"><link rel="prefetch" href="/quweiqian/assets/js/531.048e8e9f.js"><link rel="prefetch" href="/quweiqian/assets/js/54.77ec35ca.js"><link rel="prefetch" href="/quweiqian/assets/js/55.0155b92e.js"><link rel="prefetch" href="/quweiqian/assets/js/56.7b8fb311.js"><link rel="prefetch" href="/quweiqian/assets/js/57.d4610d83.js"><link rel="prefetch" href="/quweiqian/assets/js/58.a23bcfe2.js"><link rel="prefetch" href="/quweiqian/assets/js/59.5b45fb7a.js"><link rel="prefetch" href="/quweiqian/assets/js/6.852c1cf6.js"><link rel="prefetch" href="/quweiqian/assets/js/60.5852f880.js"><link rel="prefetch" href="/quweiqian/assets/js/61.ed5db516.js"><link rel="prefetch" href="/quweiqian/assets/js/62.07986eb0.js"><link rel="prefetch" href="/quweiqian/assets/js/63.946a7c10.js"><link rel="prefetch" href="/quweiqian/assets/js/64.2df7eddb.js"><link rel="prefetch" href="/quweiqian/assets/js/65.a9ad7524.js"><link rel="prefetch" href="/quweiqian/assets/js/66.2d2e9bc3.js"><link rel="prefetch" href="/quweiqian/assets/js/67.b6d29865.js"><link rel="prefetch" href="/quweiqian/assets/js/68.5c191671.js"><link rel="prefetch" href="/quweiqian/assets/js/69.437a75e4.js"><link rel="prefetch" href="/quweiqian/assets/js/7.9f6dc1ad.js"><link rel="prefetch" href="/quweiqian/assets/js/70.bc4c17db.js"><link rel="prefetch" href="/quweiqian/assets/js/71.99583413.js"><link rel="prefetch" href="/quweiqian/assets/js/72.41daecef.js"><link rel="prefetch" href="/quweiqian/assets/js/73.f1332d5a.js"><link rel="prefetch" href="/quweiqian/assets/js/74.ad6da0ac.js"><link rel="prefetch" href="/quweiqian/assets/js/75.334a7ce5.js"><link rel="prefetch" href="/quweiqian/assets/js/76.22a56aa5.js"><link rel="prefetch" href="/quweiqian/assets/js/77.0831bbe0.js"><link rel="prefetch" href="/quweiqian/assets/js/78.7252d1bd.js"><link rel="prefetch" href="/quweiqian/assets/js/79.2e2d3e63.js"><link rel="prefetch" href="/quweiqian/assets/js/8.a3d91f80.js"><link rel="prefetch" href="/quweiqian/assets/js/80.441b973c.js"><link rel="prefetch" href="/quweiqian/assets/js/81.0b4a181e.js"><link rel="prefetch" href="/quweiqian/assets/js/82.dd8dd2d9.js"><link rel="prefetch" href="/quweiqian/assets/js/83.a9576c8f.js"><link rel="prefetch" href="/quweiqian/assets/js/84.34018d2d.js"><link rel="prefetch" href="/quweiqian/assets/js/85.573af1ba.js"><link rel="prefetch" href="/quweiqian/assets/js/86.0033096a.js"><link rel="prefetch" href="/quweiqian/assets/js/87.33eee731.js"><link rel="prefetch" href="/quweiqian/assets/js/88.8c1df3e7.js"><link rel="prefetch" href="/quweiqian/assets/js/89.83d3c242.js"><link rel="prefetch" href="/quweiqian/assets/js/9.8f7d3e38.js"><link rel="prefetch" href="/quweiqian/assets/js/90.d8129294.js"><link rel="prefetch" href="/quweiqian/assets/js/91.2773d070.js"><link rel="prefetch" href="/quweiqian/assets/js/92.1200560c.js"><link rel="prefetch" href="/quweiqian/assets/js/93.4ebd0996.js"><link rel="prefetch" href="/quweiqian/assets/js/94.6d5a95ec.js"><link rel="prefetch" href="/quweiqian/assets/js/95.8b238428.js"><link rel="prefetch" href="/quweiqian/assets/js/96.8e7a918c.js"><link rel="prefetch" href="/quweiqian/assets/js/97.0ecacb49.js"><link rel="prefetch" href="/quweiqian/assets/js/98.3a3fa801.js"><link rel="prefetch" href="/quweiqian/assets/js/99.24da1b30.js">
    <link rel="stylesheet" href="/quweiqian/assets/css/0.styles.e8fe9d41.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/quweiqian/" class="home-link router-link-active"><!----> <span class="site-name">以学愈愚</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/quweiqian/" class="nav-link">
  home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="context Menu" class="dropdown-title"><span class="title">基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="context Menu" class="mobile-dropdown-title"><span class="title">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/quweiqian/base/frontend-base-htmlcss-master/5/10.html" class="nav-link">
  HTML+CSS 基础
</a></li><li class="dropdown-item"><!----> <a href="/quweiqian/base/webapp/1-1.html" class="nav-link">
  webapp
</a></li><li class="dropdown-item"><!----> <a href="/quweiqian/base/vue3/1.html" class="nav-link">
  vue3
</a></li></ul></div></div><div class="nav-item"><a href="/quweiqian/duyi/frontend-pre-htmlcss-master/01.html" class="nav-link">
  固定学习
</a></div><div class="nav-item"><a href="/quweiqian/interview/frontend-interview-html-master/1.html" class="nav-link">
  笔面试
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="context Menu" class="dropdown-title"><span class="title">详细版</span> <span class="arrow down"></span></button> <button type="button" aria-label="context Menu" class="mobile-dropdown-title"><span class="title">详细版</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/quweiqian/particular/html5/1.html" class="nav-link">
  html5详细版
</a></li><li class="dropdown-item"><!----> <a href="/quweiqian/particular/frontend-es6-particular-master/1.html" class="nav-link">
  ES6详细版
</a></li><li class="dropdown-item"><!----> <a href="/quweiqian/particular/frontend-module-particular-master/1.html" class="nav-link">
  模块化详细版
</a></li><li class="dropdown-item"><!----> <a href="/quweiqian/particular/frontend-packagemanager-particular-master/1.html" class="nav-link">
  包管理器详细版
</a></li><li class="dropdown-item"><!----> <a href="/quweiqian/particular/frontend-webpack-particular-master/1.1.html" class="nav-link">
  webpack详细版
</a></li></ul></div></div><div class="nav-item"><a href="/quweiqian/es6/intro.html" class="nav-link">
  es6阮
</a></div><div class="nav-item"><a href="/quweiqian/fragments/1.html" class="nav-link">
  散记
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/quweiqian/" class="nav-link">
  home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="context Menu" class="dropdown-title"><span class="title">基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="context Menu" class="mobile-dropdown-title"><span class="title">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/quweiqian/base/frontend-base-htmlcss-master/5/10.html" class="nav-link">
  HTML+CSS 基础
</a></li><li class="dropdown-item"><!----> <a href="/quweiqian/base/webapp/1-1.html" class="nav-link">
  webapp
</a></li><li class="dropdown-item"><!----> <a href="/quweiqian/base/vue3/1.html" class="nav-link">
  vue3
</a></li></ul></div></div><div class="nav-item"><a href="/quweiqian/duyi/frontend-pre-htmlcss-master/01.html" class="nav-link">
  固定学习
</a></div><div class="nav-item"><a href="/quweiqian/interview/frontend-interview-html-master/1.html" class="nav-link">
  笔面试
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="context Menu" class="dropdown-title"><span class="title">详细版</span> <span class="arrow down"></span></button> <button type="button" aria-label="context Menu" class="mobile-dropdown-title"><span class="title">详细版</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/quweiqian/particular/html5/1.html" class="nav-link">
  html5详细版
</a></li><li class="dropdown-item"><!----> <a href="/quweiqian/particular/frontend-es6-particular-master/1.html" class="nav-link">
  ES6详细版
</a></li><li class="dropdown-item"><!----> <a href="/quweiqian/particular/frontend-module-particular-master/1.html" class="nav-link">
  模块化详细版
</a></li><li class="dropdown-item"><!----> <a href="/quweiqian/particular/frontend-packagemanager-particular-master/1.html" class="nav-link">
  包管理器详细版
</a></li><li class="dropdown-item"><!----> <a href="/quweiqian/particular/frontend-webpack-particular-master/1.1.html" class="nav-link">
  webpack详细版
</a></li></ul></div></div><div class="nav-item"><a href="/quweiqian/es6/intro.html" class="nav-link">
  es6阮
</a></div><div class="nav-item"><a href="/quweiqian/fragments/1.html" class="nav-link">
  散记
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>笔面试</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Promise</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>浏览器</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/quweiqian/interview/frontend-interview-browser-master/1.html" class="sidebar-link">浏览器的渲染流程</a></li><li><a href="/quweiqian/interview/frontend-interview-browser-master/a1.html" class="sidebar-link">浏览器的渲染原理(袁)</a></li><li><a href="/quweiqian/interview/frontend-interview-browser-master/2.html" class="sidebar-link">资源提示关键词</a></li><li><a href="/quweiqian/interview/frontend-interview-browser-master/3.html" class="sidebar-link">浏览器的组成部分</a></li><li><a href="/quweiqian/interview/frontend-interview-browser-master/4.html" class="sidebar-link">浏览器的离线存储概述</a></li><li><a href="/quweiqian/interview/frontend-interview-browser-master/5.html" class="sidebar-link">WebSQL</a></li><li><a href="/quweiqian/interview/frontend-interview-browser-master/6.html" aria-current="page" class="active sidebar-link">IndexedDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/quweiqian/interview/frontend-interview-browser-master/6.html#indexeddb-简介" class="sidebar-link">IndexedDB 简介</a></li><li class="sidebar-sub-header"><a href="/quweiqian/interview/frontend-interview-browser-master/6.html#indexeddb-重要概念" class="sidebar-link">IndexedDB 重要概念</a></li><li class="sidebar-sub-header"><a href="/quweiqian/interview/frontend-interview-browser-master/6.html#indexeddb-实操" class="sidebar-link">IndexedDB 实操</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/quweiqian/interview/frontend-interview-browser-master/6.html#操作数据库" class="sidebar-link">操作数据库</a></li><li class="sidebar-sub-header"><a href="/quweiqian/interview/frontend-interview-browser-master/6.html#插入数据" class="sidebar-link">插入数据</a></li><li class="sidebar-sub-header"><a href="/quweiqian/interview/frontend-interview-browser-master/6.html#读取数据" class="sidebar-link">读取数据</a></li><li class="sidebar-sub-header"><a href="/quweiqian/interview/frontend-interview-browser-master/6.html#通过主键读取数据" class="sidebar-link">通过主键读取数据</a></li><li class="sidebar-sub-header"><a href="/quweiqian/interview/frontend-interview-browser-master/6.html#更新数据" class="sidebar-link">更新数据</a></li><li class="sidebar-sub-header"><a href="/quweiqian/interview/frontend-interview-browser-master/6.html#删除数据" class="sidebar-link">删除数据</a></li></ul></li><li class="sidebar-sub-header"><a href="/quweiqian/interview/frontend-interview-browser-master/6.html#课堂代码" class="sidebar-link">课堂代码</a></li></ul></li><li><a href="/quweiqian/interview/frontend-interview-browser-master/7.html" class="sidebar-link">File API</a></li><li><a href="/quweiqian/interview/frontend-interview-browser-master/8.html" class="sidebar-link">浏览器的缓存</a></li><li><a href="/quweiqian/interview/frontend-interview-browser-master/9.html" class="sidebar-link">跨标签页通信概述</a></li><li><a href="/quweiqian/interview/frontend-interview-browser-master/18.html" class="sidebar-link">Web Worker</a></li><li><a href="/quweiqian/interview/frontend-interview-browser-master/19.html" class="sidebar-link">浏览器面试题汇总</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>网络-Ⅲ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>工程化-Ⅲ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="indexeddb"><a href="#indexeddb" class="header-anchor">#</a> <em>IndexedDB</em></h1> <p>本文主要包含以下内容：</p> <ul><li><em>IndexedDB</em> 简介</li> <li><em>IndexedDB</em> 重要概念</li> <li><em>IndexedDB</em> 实操
<ul><li>操作数据库</li> <li>插入数据</li> <li>读取数据</li> <li>更新数据</li> <li>删除数据</li></ul></li></ul> <h2 id="indexeddb-简介"><a href="#indexeddb-简介" class="header-anchor">#</a> <em>IndexedDB</em> 简介</h2> <p>随着浏览器的功能不断增强，越来越多的网站开始考虑，将大量数据储存在客户端，这样可以减少从服务器获取数据，直接从本地获取数据。</p> <p>现有的浏览器数据储存方案，都不适合储存大量数据：<em>Cookie</em> 的大小不超过 <em>4KB</em>，且每次请求都会发送回服务器；<em>LocalStorage</em> 在 <em>2.5MB</em> 到 <em>10MB</em> 之间（各家浏览器不同），而且不提供搜索功能，不能建立自定义的索引。所以，需要一种新的解决方案，这就是 <em>IndexedDB</em> 诞生的背景。</p> <img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2021-12-01-015214.png" alt="image-20211201094954024" style="zoom:50%;"> <p><em>MDN</em> 官网是这样解释 <em>IndexedDB</em> 的：</p> <blockquote><p><em>IndexedDB</em> 是一种底层 <em>API</em>，用于在客户端存储大量的结构化数据（也包括文件/二进制大型对象（<em>blobs</em>））。该 <em>API</em> 使用索引实现对数据的高性能搜索。虽然 <em>Web Storage</em> 在存储较少量的数据很有用，但对于存储更大量的结构化数据来说力不从心。而 <em>IndexedDB</em> 提供了这种场景的解决方案。</p></blockquote> <p>通俗地说，<em>IndexedDB</em> 就是浏览器提供的本地数据库，它可以被网页脚本创建和操作。<em>IndexedDB</em> 允许储存大量数据，提供查找接口，还能建立索引。这些都是 <em>LocalStorage</em> 所不具备的。就数据库类型而言，<em>IndexedDB</em> 不属于关系型数据库（不支持 <em>SQL</em> 查询语句），更接近 <em>NoSQL</em> 数据库。</p> <p>下表罗列出了几种常见的客户端存储方式的对比：</p> <table><thead><tr><th></th> <th>会话期 Cookie</th> <th>持久性 Cookie</th> <th>sessionStorage</th> <th>localStorage</th> <th>IndexedDB</th> <th>WebSQL</th></tr></thead> <tbody><tr><td>存储大小</td> <td>4kb</td> <td>4kb</td> <td>2.5~10MB</td> <td>2.5~10MB</td> <td>&gt;250MB</td> <td>已废弃</td></tr> <tr><td>失效时间</td> <td>浏览器关闭自动清除</td> <td>设置过期时间，到期后清除</td> <td>浏览器关闭后清除</td> <td>永久保存（除非手动清除）</td> <td>手动更新或删除</td> <td>已废弃</td></tr></tbody></table> <p><em>IndexedDB</em> 具有以下特点。</p> <ul><li><p>键值对储存：<em>IndexedDB</em> 内部采用对象仓库（ <em>object store</em> ）存放数据。所有类型的数据都可以直接存入，包括 <em>JavaScript</em> 对象。对象仓库中，数据以“键值对”的形式保存，每一个数据记录都有对应的主键，主键是独一无二的，不能有重复，否则会抛出一个错误。</p></li> <li><p>异步：<em>IndexedDB</em> 操作时不会锁死浏览器，用户依然可以进行其他操作，这与 <em>LocalStorage</em> 形成对比，后者的操作是同步的。异步设计是为了防止大量数据的读写，拖慢网页的表现。</p></li> <li><p>支持事务：<em>IndexedDB</em> 支持事务（ <em>transaction</em> ），这意味着一系列操作步骤之中，只要有一步失败，整个事务就都取消，数据库回滚到事务发生之前的状态，不存在只改写一部分数据的情况。这和 <em>MySQL</em> 等数据库的事务类似。</p></li> <li><p>同源限制：<em>IndexedDB</em> 受到同源限制，每一个数据库对应创建它的域名。网页只能访问自身域名下的数据库，而不能访问跨域的数据库。</p></li> <li><p>储存空间大：这是 <em>IndexedDB</em> 最显著的特点之一。<em>IndexedDB</em> 的储存空间比 <em>LocalStorage</em> 大得多，一般来说不少于 <em>250MB</em>，甚至没有上限。</p></li> <li><p>支持二进制储存：<em>IndexedDB</em> 不仅可以储存字符串，还可以储存二进制数据（<em>ArrayBuffer</em> 对象和 <em>Blob</em> 对象）。</p></li></ul> <p><em>IndexedDB</em> 主要使用在于客户端需要存储大量的数据的场景下：</p> <ul><li><p>数据可视化等界面，大量数据，每次请求会消耗很大性能。</p></li> <li><p>即时聊天工具，大量消息需要存在本地。</p></li> <li><p>其它存储方式容量不满足时，不得已使用 <em>IndexedDB</em></p></li></ul> <h2 id="indexeddb-重要概念"><a href="#indexeddb-重要概念" class="header-anchor">#</a> <em>IndexedDB</em> 重要概念</h2> <p>在正式开始之前，我们先来介绍一下 <em>IndexedDB</em> 里面一些重要的概念。</p> <p><em>IndexedDB</em> 是一个比较复杂的 <em>API</em>，涉及不少概念。它把不同的实体，抽象成一个个对象接口。学习这个 <em>API</em>，就是学习它的各种对象接口。</p> <ul><li><p>数据库：<em>IDBDatabase</em> 对象</p></li> <li><p>对象仓库：<em>IDBObjectStore</em> 对象</p></li> <li><p>索引：<em>IDBIndex</em> 对象</p></li> <li><p>事务：<em>IDBTransaction</em> 对象</p></li> <li><p>操作请求：<em>IDBRequest</em> 对象</p></li> <li><p>指针：<em>IDBCursor</em> 对象</p></li> <li><p>主键集合：<em>IDBKeyRange</em> 对象</p></li></ul> <p>下面是一些主要的概念。</p> <p>（1）数据库</p> <p>数据库是一系列相关数据的容器。每个域名（严格的说，是协议 + 域名 + 端口）都可以新建任意多个数据库。</p> <p><em>IndexedDB</em> 数据库有版本的概念。同一个时刻，只能有一个版本的数据库存在。如果要修改数据库结构（新增或删除表、索引或者主键），只能通过升级数据库版本完成。</p> <p>（2）对象仓库</p> <p>每个数据库包含若干个对象仓库（ <em>object store</em> ）。它类似于关系型数据库的表格。</p> <p>（3）数据记录</p> <p>对象仓库保存的是数据记录。每条记录类似于关系型数据库的行，但是只有主键和数据体两部分。主键用来建立默认的索引，必须是不同的，否则会报错。主键可以是数据记录里面的一个属性，也可以指定为一个递增的整数编号。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'foo'</span> <span class="token punctuation">}</span>
</code></pre></div><p>上面的对象中，<em>id</em> 属性可以当作主键。</p> <p>数据体可以是任意数据类型，不限于对象。</p> <p>（4）索引</p> <p>为了加速数据的检索，可以在对象仓库里面，为不同的属性建立索引。</p> <p>在关系型数据库当中也有索引的概念，我们可以给对应的表字段添加索引，以便加快查找速率。在 <em>IndexedDB</em> 中同样有索引，我们可以在创建 <em>store</em> 的时候同时创建索引，在后续对 <em>store</em> 进行查询的时候即可通过索引来筛选，给某个字段添加索引后，在后续插入数据的过成功，索引字段便不能为空。</p> <p>（5）事务</p> <p>数据记录的读写和删改，都要通过事务完成。事务对象提供 <em>error、abort</em> 和 <em>complete</em> 三个事件，用来监听操作结果。</p> <p>（6）指针（游标）
游标是 <em>IndexedDB</em> 数据库新的概念，大家可以把游标想象为一个指针，比如我们要查询满足某一条件的所有数据时，就需要用到游标，我们让游标一行一行的往下走，游标走到的地方便会返回这一行数据，此时我们便可对此行数据进行判断，是否满足条件。</p> <h2 id="indexeddb-实操"><a href="#indexeddb-实操" class="header-anchor">#</a> <em>IndexedDB</em> 实操</h2> <p><em>IndexedDB</em> 所有针对仓库的操作都是基于事务的。</p> <p>在正式开始之前，我们先创建如下的项目结构：</p> <img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2021-12-01-015307.png" alt="image-20211201095256757" style="zoom:50%;"> <p>该项目目录下存在 <em>2</em> 个文件，其中 <em>db.js</em> 是用来封装各种数据库操作的。</p> <h3 id="操作数据库"><a href="#操作数据库" class="header-anchor">#</a> 操作数据库</h3> <p>首先第一步是创建以及连接数据库。</p> <p><em>db.js</em></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 打开数据库
 * @param {object} dbName 数据库的名字
 * @param {string} storeName 仓库名称
 * @param {string} version 数据库的版本
 * @return {object} 该函数会返回一个数据库实例
 */</span>
<span class="token keyword">function</span> <span class="token function">openDB</span><span class="token punctuation">(</span><span class="token parameter">dbName<span class="token punctuation">,</span> version <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> db<span class="token punctuation">;</span> <span class="token comment">// 存储创建的数据库</span>
        <span class="token comment">// 打开数据库，若没有则会创建</span>
        <span class="token keyword">const</span> request <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>dbName<span class="token punctuation">,</span> version<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 数据库打开成功回调</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span> <span class="token comment">// 存储数据库对象</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;数据库打开成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// 数据库打开失败的回调</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;数据库打开报错&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// 数据库有更新时候的回调</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 数据库创建或升级的时候会触发</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;onupgradeneeded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span> <span class="token comment">// 存储数据库对象</span>
            <span class="token keyword">var</span> objectStore<span class="token punctuation">;</span>
            <span class="token comment">// 创建存储库</span>
            objectStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">keyPath</span><span class="token operator">:</span> <span class="token string">&quot;stuId&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 这是主键</span>
                <span class="token literal-property property">autoIncrement</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 实现自增</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 创建索引，在后面查询数据的时候可以根据索引查</span>
            objectStore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">&quot;stuId&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;stuId&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">unique</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            objectStore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">&quot;stuName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;stuName&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">unique</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            objectStore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">&quot;stuAge&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;stuAge&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">unique</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在上面的代码中，我们封装了一个 <em>openDB</em> 的函数，该函数调用 <em>indexedDB.open</em> 方法来尝试打开一个数据库，如果该数据库不存在，就会创建。</p> <p><em>indexedDB.open</em> 方法返回一个对象，我们在这个对象上面分别监听了成功、错误以及更新这三个事件。</p> <p>这里尤其要说一下 <em>upgradeneeded</em> 更新事件。该事件会在数据库发生更新时触发，什么叫做数据库有更新时呢？就是添加或删除表，以及数据库版本号更新的时候。</p> <p>因为一开始创建数据库时，版本是从无到有，所以也会触发这个事件。</p> <p><em>index.html</em></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./db.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token function">openDB</span><span class="token punctuation">(</span><span class="token string">'stuDB'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在 <em>index.html</em> 文件中，我们引入了 <em>db.js</em>，然后调用了 <em>openDB</em> 方法，效果如下图所示。</p> <p><img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2021-12-01-015341.png" alt="image-20211201095341185"></p> <p>使用完数据库后，建议关闭数据库，以节约资源。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 关闭数据库
 * @param {object} db 数据库实例
 */</span>
<span class="token keyword">function</span> <span class="token function">closeDB</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;数据库已关闭&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果要删除数据库，可以使用 <em>indexDB</em> 的 <em>deleteDatabase</em> 方法即可。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 删除数据库
 * @param {object} dbName 数据库名称
 */</span>
<span class="token keyword">function</span> <span class="token function">deleteDBAll</span><span class="token punctuation">(</span><span class="token parameter">dbName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> deleteRequest <span class="token operator">=</span> window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">.</span><span class="token function">deleteDatabase</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  deleteRequest<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;删除失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  deleteRequest<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;删除成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="插入数据"><a href="#插入数据" class="header-anchor">#</a> 插入数据</h3> <p>接下来是插入数据，我们仍然封装一个 <em>addData</em> 方法，代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 新增数据
 * @param {object} db 数据库实例
 * @param {string} storeName 仓库名称
 * @param {string} data 数据
 */</span>
<span class="token keyword">function</span> <span class="token function">addData</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> storeName<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> request <span class="token operator">=</span> db
        <span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span>storeName<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;readwrite&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 事务对象 指定表格名称和操作模式（&quot;只读&quot;或&quot;读写&quot;）</span>
        <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span> <span class="token comment">// 仓库对象</span>
        <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

    request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;数据写入成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;数据写入失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em>IndexedDB</em> 插入数据需要通过事务来进行操作，插入的方法也很简单，利用 <em>IndexedDB</em> 提供的 <em>add</em> 方法即可，这里我们同样将插入数据的操作封装成了一个函数，接收三个参数，分别如下：</p> <ul><li><em>db</em>：在创建或连接数据库时，返回的 <em>db</em> 实例，需要那个时候保存下来。</li> <li><em>storeName</em>：仓库名称(或者表名)，在创建或连接数据库时我们就已经创建好了仓库。</li> <li><em>data</em>：需要插入的数据，通常是一个对象。</li></ul> <p>接下来我们在 <em>index.html</em> 中来测试。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./db.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token function">openDB</span><span class="token punctuation">(</span><span class="token string">'stuDB'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;谢杰&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;雅静&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;谢希之&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>效果如下：</p> <p><img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2021-12-01-015402.png" alt="image-20211201095402192"></p> <blockquote><p>注意：插入的数据是一个对象，而且必须包含我们声明的索引键值对。</p></blockquote> <h3 id="读取数据"><a href="#读取数据" class="header-anchor">#</a> 读取数据</h3> <p>读取数据根据需求的不同有不同的读取方式。</p> <h3 id="通过主键读取数据"><a href="#通过主键读取数据" class="header-anchor">#</a> 通过主键读取数据</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 通过主键读取数据
 * @param {object} db 数据库实例
 * @param {string} storeName 仓库名称
 * @param {string} key 主键值
 */</span>
<span class="token keyword">function</span> <span class="token function">getDataByKey</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> storeName<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> transaction <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span>storeName<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 事务</span>
        <span class="token keyword">var</span> objectStore <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 仓库对象</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> objectStore<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过主键获取数据</span>

        request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;事务失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;主键查询结果: &quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在我在仓库对象上面调用 <em>get</em> 方法从而通过主键获取数据。</p> <p><em>index.html</em></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./db.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token function">openDB</span><span class="token punctuation">(</span><span class="token string">'stuDB'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;谢杰&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;雅静&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;谢希之&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token function">getDataByKey</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">stuInfo</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stuInfo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {stuId: 2, stuName: '雅静', stuAge: 20}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在 <em>index.html</em> 中进行测试，调用上面封装的 <em>getDataByKey</em> 方法，可以看到返回了主键 <em>stuId</em> 为 <em>2</em> 的学生数据。</p> <p>仓库对象也提供了 <em>getAll</em> 方法， 能够查询整张表的数据内容。</p> <p><em>db.js</em></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 通过主键读取数据
 * @param {object} db 数据库实例
 * @param {string} storeName 仓库名称
 * @param {string} key 主键值
 */</span>
<span class="token keyword">function</span> <span class="token function">getDataByKey</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> storeName<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> objectStore<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过主键获取数据</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在 <em>index.html</em> 中调用方法时就需要再传递第三个参数作为 <em>key</em> 了。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">openDB</span><span class="token punctuation">(</span><span class="token string">'stuDB'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;谢杰&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;雅静&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;谢希之&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">getDataByKey</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">stuInfo</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stuInfo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 会查询到该表的所有数据</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>还可以通过指针来进行查询，例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 通过游标读取数据
 * @param {object} db 数据库实例
 * @param {string} storeName 仓库名称
 */</span>
<span class="token keyword">function</span> <span class="token function">cursorGetData</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> storeName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> store <span class="token operator">=</span> db
            <span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span>storeName<span class="token punctuation">,</span> <span class="token string">&quot;readwrite&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 事务</span>
            <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 仓库对象</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 指针对象</span>
        <span class="token comment">// 游标开启成功，逐行读数据</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> cursor <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 必须要检查</span>
                list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 遍历了存储对象中的所有内容</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在上面的代码中，我们通过仓库对象的 <em>openCursor</em> 方法开启了一个指针，这个指针会指向数据表的第一条数据，之后指针逐项进行偏移从而遍历整个数据表。</p> <p>所以每次偏移拿到数据后，我们 <em>push</em> 到 <em>list</em> 数组里面，如果某一次没有拿到数据，说明已经读取完了所有的数据，那么我们就返回 <em>list</em> 数组。</p> <p><em>indx.html</em></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">openDB</span><span class="token punctuation">(</span><span class="token string">'stuDB'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;谢杰&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;雅静&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;谢希之&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">cursorGetData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">stuInfo</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stuInfo<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>目前为止，我们的精准查询只能通过主键来进行查询。但是更多的场景是我们压根儿就不知道某一条数据的主键。例如我们要查询学生姓名为“张三”的学生数据，对于我们来讲，我们知道的信息只有学生姓名“张三”。</p> <p>此时我们就可以通过索引来查询数据。</p> <p><em>db.js</em></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 通过索引读取数据
 * @param {object} db 数据库实例
 * @param {string} storeName 仓库名称
 * @param {string} indexName 索引名称
 * @param {string} indexValue 索引值
 */</span>
<span class="token keyword">function</span> <span class="token function">getDataByIndex</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> storeName<span class="token punctuation">,</span> indexName<span class="token punctuation">,</span> indexValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> store <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span>storeName<span class="token punctuation">,</span> <span class="token string">&quot;readwrite&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>indexName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>indexValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;事务失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> result <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在上面的方法中，我们通过仓库对象的 <em>index</em> 方法传入了索引名称，然后链式调用 <em>get</em> 方法传入索引的值来得到最终的查询结果。</p> <p><em>index.html</em></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">openDB</span><span class="token punctuation">(</span><span class="token string">'stuDB'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;牛牛&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">getDataByIndex</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;stuAge&quot;</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">stuInfo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stuInfo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {stuId: 3, stuName: '谢希之', stuAge: 4}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>在 <em>index.html</em> 中我们新增了一条数据，年龄也为 <em>4</em>，当前的数据库表信息如下：</p> <p><img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2021-12-01-015426.png" alt="image-20211201095425944"></p> <p>但是很奇怪的是我们查询出来的数据却只有第一条符合要求的。</p> <p>如果我们想要查询出索引中满足某些条件的所有数据，可以将索引和游标结合起来。</p> <p><em>db.js</em></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 通过索引和游标查询记录
 * @param {object} db 数据库实例
 * @param {string} storeName 仓库名称
 * @param {string} indexName 索引名称
 * @param {string} indexValue 索引值
 */</span>
<span class="token keyword">function</span> <span class="token function">cursorGetDataByIndex</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> storeName<span class="token punctuation">,</span> indexName<span class="token punctuation">,</span> indexValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> store <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span>storeName<span class="token punctuation">,</span> <span class="token string">&quot;readwrite&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 仓库对象</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> store
            <span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>indexName<span class="token punctuation">)</span> <span class="token comment">// 索引对象</span>
            <span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span>IDBKeyRange<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>indexValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 指针对象</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> cursor <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 必须要检查</span>
                list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 遍历了存储对象中的所有内容</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在上面的方法中，我们仍然是使用仓库对象的 <em>index</em> 方法进行索引查询，但是之后链式调用的时候不再是使用 <em>get</em> 方法传入索引值，而是调用了 <em>openCursor</em> 来打开一个指针，并且让指针指向满足索引值的数据，之后和前面一样，符合要求的数据推入到 <em>list</em> 数组，最后返回 <em>list</em> 数组。</p> <p>当然，你可能很好奇 <em>IDBKeyRange</em> 的 <em>only</em> 方法是什么意思，除了 <em>only</em> 方法还有其他方法么？</p> <p><em>IDBKeyRange</em> 对象代表数据仓库（<em>object store</em>）里面的一组主键。根据这组主键，可以获取数据仓库或索引里面的一组记录。</p> <p><em>IDBKeyRange</em> 可以只包含一个值，也可以指定上限和下限。它有四个静态方法，用来指定主键的范围。</p> <ul><li><p><em>IDBKeyRange.lowerBound( )</em>：指定下限。</p></li> <li><p><em>IDBKeyRange.upperBound( )</em>：指定上限。</p></li> <li><p><em>IDBKeyRange.bound( )</em>：同时指定上下限。</p></li> <li><p><em>IDBKeyRange.only( )</em>：指定只包含一个值。</p></li></ul> <p>下面是一些代码实例。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// All keys ≤ x</span>
<span class="token keyword">var</span> r1 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">upperBound</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// All keys &lt; x</span>
<span class="token keyword">var</span> r2 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">upperBound</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// All keys ≥ y</span>
<span class="token keyword">var</span> r3 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">lowerBound</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// All keys &gt; y</span>
<span class="token keyword">var</span> r4 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">lowerBound</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// All keys ≥ x &amp;&amp; ≤ y</span>
<span class="token keyword">var</span> r5 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// All keys &gt; x &amp;&amp;&lt; y</span>
<span class="token keyword">var</span> r6 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// All keys &gt; x &amp;&amp; ≤ y</span>
<span class="token keyword">var</span> r7 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// All keys ≥ x &amp;&amp;&lt; y</span>
<span class="token keyword">var</span> r8 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// The key = z</span>
<span class="token keyword">var</span> r9 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>例如我们来查询年龄大于 <em>4</em> 岁的学生，其代码片段如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">cursorGetDataByIndex</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> storeName<span class="token punctuation">,</span> indexName<span class="token punctuation">,</span> indexValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> store
            <span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>indexName<span class="token punctuation">)</span> <span class="token comment">// 索引对象</span>
            <span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span>IDBKeyRange<span class="token punctuation">.</span><span class="token function">lowerBound</span><span class="token punctuation">(</span>indexValue<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 指针对象</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre></div><p>利用索引和游标结合查询，我们可以查询出索引值满足我们传入函数值的所有数据对象，而不是只查询出一条数据或者所有数据。</p> <p><em>IndexedDB</em> 分页查询不像 <em>MySQL</em> 分页查询那么简单，没有提供现成的 <em>API</em>，如 <em>limit</em> 等，所以需要我们自己实现分页。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 通过索引和游标分页查询记录
 * @param {object} db 数据库实例
 * @param {string} storeName 仓库名称
 * @param {string} indexName 索引名称
 * @param {string} indexValue 索引值
 * @param {number} page 页码
 * @param {number} pageSize 查询条数
 */</span>
<span class="token keyword">function</span> <span class="token function">cursorGetDataByIndexAndPage</span><span class="token punctuation">(</span>
    <span class="token parameter">db<span class="token punctuation">,</span>
    storeName<span class="token punctuation">,</span>
    indexName<span class="token punctuation">,</span>
    indexValue<span class="token punctuation">,</span>
    page<span class="token punctuation">,</span>
    pageSize</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 计数器</span>
        <span class="token keyword">var</span> advanced <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 是否跳过多少条查询</span>
        <span class="token keyword">var</span> store <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span>storeName<span class="token punctuation">,</span> <span class="token string">&quot;readwrite&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 仓库对象</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> store
            <span class="token comment">// .index(indexName) // 索引对象</span>
            <span class="token comment">// .openCursor(IDBKeyRange.only(indexValue)); // 按照指定值分页查询（配合索引）</span>
            <span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 指针对象</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> cursor <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>page <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> advanced<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                advanced <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                cursor<span class="token punctuation">.</span><span class="token function">advance</span><span class="token punctuation">(</span><span class="token punctuation">(</span>page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 跳过多少条</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 必须要检查</span>
                list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                counter<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>counter <span class="token operator">&lt;</span> pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 遍历了存储对象中的所有内容</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    cursor <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里用到了 <em>IndexedDB</em> 的一个 <em>API</em>：<em>advance</em>。</p> <p>该函数可以让我们的游标跳过多少条开始查询。假如我们的额分页是每页 <em>5</em> 条数据，现在需要查询第 <em>2</em> 页，那么我们就需要跳过前面 <em>5</em> 条数据，从第 <em>6</em> 条数据开始查询，直到计数器等于 <em>5</em>，那么我们就关闭游标，结束查询。</p> <p>下面在 <em>index.html</em> 中进行测试如下：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./db.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token function">openDB</span><span class="token punctuation">(</span><span class="token string">'stuDB'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">23</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">24</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;王武&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">32</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;刘德华&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">34</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;张学友&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">28</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;郭富城&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">27</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;黎明&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">17</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;邓超&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">19</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;刘翔&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">15</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;洋洋&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">12</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;林佳音&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">14</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;袁进&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">34</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;老闫&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">36</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">addData</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;stuId&quot;</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;沈爷&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;stuAge&quot;</span><span class="token operator">:</span> <span class="token number">34</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token function">cursorGetDataByIndexAndPage</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">stuInfo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stuInfo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {stuId: 3, stuName: '谢希之', stuAge: 4}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在上面的代码中，我们为了实现分页效果，添加了一些数据。然后查询第 <em>3</em> 页的内容。</p> <p><img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2021-12-01-015453.png" alt="image-20211201095452722"></p> <p>查询结果如下：</p> <img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2021-12-01-015510.png" alt="image-20211201095509714" style="zoom:50%;"> <h3 id="更新数据"><a href="#更新数据" class="header-anchor">#</a> 更新数据</h3> <p><em>IndexedDB</em> 更新数据较为简单，直接使用 <em>put</em> 方法，值得注意的是如果数据库中没有该条数据，则会默认增加该条数据，否则更新。</p> <p>有些小伙伴喜欢更新和新增都是用 <em>put</em> 方法，这也是可行的。</p> <p><em>db.js</em></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 更新数据
 * @param {object} db 数据库实例
 * @param {string} storeName 仓库名称
 * @param {object} data 数据
 */</span>
<span class="token keyword">function</span> <span class="token function">updateDB</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> storeName<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> db
            <span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span>storeName<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;readwrite&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 事务对象</span>
            <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span> <span class="token comment">// 仓库对象</span>
            <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

        request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;更新数据成功&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;更新数据失败&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在上面的方法中，我们使用仓库对象的 <em>put</em> 方法来修改数据，所以在调用该方法时，需要传入整条数据对象，特别是主键。因为是通过主键来查询到要修改的数据。</p> <p>如果传入的数据没有主键，则是一个新增数据的效果。</p> <p><em>index.html</em></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">openDB</span><span class="token punctuation">(</span><span class="token string">'stuDB'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">updateDB</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">stuId</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">stuName</span><span class="token operator">:</span> <span class="token string">'谢杰2'</span><span class="token punctuation">,</span> <span class="token literal-property property">stuAge</span><span class="token operator">:</span> <span class="token number">19</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>效果如下：</p> <p><img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2021-12-01-015532.png" alt="image-20211201095532213"></p> <h3 id="删除数据"><a href="#删除数据" class="header-anchor">#</a> 删除数据</h3> <p>删除数据这里记录 <em>2</em> 种方式，一个是通过主键来进行删除。</p> <p><em>db.js</em></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 通过主键删除数据
 * @param {object} db 数据库实例
 * @param {string} storeName 仓库名称
 * @param {object} id 主键值
 */</span>
<span class="token keyword">function</span> <span class="token function">deleteDB</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> storeName<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> db
            <span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span>storeName<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;readwrite&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

        request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;删除数据成功&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;删除数据失败&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em>index.html</em></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">openDB</span><span class="token punctuation">(</span><span class="token string">'stuDB'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">deleteDB</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>执行上面的代码后 <em>stuId</em> 为 <em>1</em> 的学生被删除掉。</p> <p>有时候我们拿不到主键值，只能只能通过索引值来删除。通过这种方式，我们可以删除一条数据（索引值唯一）或者所有满足条件的数据（索引值不唯一）。</p> <p><em>db.js</em></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 通过索引和游标删除指定的数据
 * @param {object} db 数据库实例
 * @param {string} storeName 仓库名称
 * @param {string} indexName 索引名
 * @param {object} indexValue 索引值
 */</span>
<span class="token keyword">function</span> <span class="token function">cursorDelete</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> storeName<span class="token punctuation">,</span> indexName<span class="token punctuation">,</span> indexValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> store <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span>storeName<span class="token punctuation">,</span> <span class="token string">&quot;readwrite&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> store
            <span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>indexName<span class="token punctuation">)</span> <span class="token comment">// 索引对象</span>
            <span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span>IDBKeyRange<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>indexValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 指针对象</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> cursor <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
            <span class="token keyword">var</span> deleteRequest<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                deleteRequest <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 请求删除当前项</span>
                deleteRequest<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;游标删除该记录成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;游标删除该记录成功&quot;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>
                deleteRequest<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;游标删除该记录失败&quot;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>
                cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em>index.html</em></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">openDB</span><span class="token punctuation">(</span><span class="token string">'stuDB'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">cursorDelete</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;stuName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;雅静&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> message <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>在上面的示例中，我们就删除了所有 <em>stuName</em> 值为 “雅静” 的同学。</p> <hr> <p>以上，就是关于 <em>IndexedDB</em> 的基本操作。</p> <p>可以看到，在了解了它的几个基本概念后，上手还是比较容易的。</p> <p>另外由于 <em>IndexedDB</em> 所提供的原生 <em>API</em> 比较复杂，所以现在也出现了基于 <em>IndexedDB</em> 封装的库。例如 <em>Dexie.js</em>。</p> <p><img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2021-12-01-015556.png" alt="image-20211201095555138"></p> <p>（图为 <em>Dexie.js</em> 官网部分截图）</p> <p><em>Dexie.js</em> 官网：<em>https://dexie.org/</em></p> <p>该库和 <em>IndexedDB</em> 之间的关系，就类似于 <em>jQuery</em> 和 <em>JavaScript</em> 之间的关系。有兴趣的同学可以自行进行研究，这里就不再做过多的赘述。</p> <p>如果想了解 <em>IndexedDB</em> 相关的更多 <em>API</em>，可以扩展阅读：<em>https://www.wangdoc.com/javascript/bom/indexeddb.html</em></p> <hr> <h2 id="课堂代码"><a href="#课堂代码" class="header-anchor">#</a> 课堂代码</h2> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./db.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token function">openDB</span><span class="token punctuation">(</span><span class="token string">&quot;stuDB&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token comment">// 调用添加数据方法</span>
                <span class="token comment">// addData(db, &quot;stu&quot;, { &quot;stuId&quot;: 4, &quot;stuName&quot;: &quot;谢杰&quot;, &quot;stuAge&quot;: 18 });</span>
                <span class="token comment">// addData(db, &quot;stu&quot;, { &quot;stuId&quot;: 5, &quot;stuName&quot;: &quot;张三&quot;, &quot;stuAge&quot;: 23 });</span>
                <span class="token comment">// addData(db, &quot;stu&quot;, { &quot;stuId&quot;: 6, &quot;stuName&quot;: &quot;李四&quot;, &quot;stuAge&quot;: 24 });</span>
                <span class="token comment">// addData(db, &quot;stu&quot;, { &quot;stuId&quot;: 7, &quot;stuName&quot;: &quot;王武&quot;, &quot;stuAge&quot;: 32 });</span>
                <span class="token comment">// addData(db, &quot;stu&quot;, { &quot;stuId&quot;: 8, &quot;stuName&quot;: &quot;刘德华&quot;, &quot;stuAge&quot;: 34 });</span>
                <span class="token comment">// addData(db, &quot;stu&quot;, { &quot;stuId&quot;: 9, &quot;stuName&quot;: &quot;张学友&quot;, &quot;stuAge&quot;: 28 });</span>
                <span class="token comment">// addData(db, &quot;stu&quot;, { &quot;stuId&quot;: 10, &quot;stuName&quot;: &quot;郭富城&quot;, &quot;stuAge&quot;: 27 });</span>
                <span class="token comment">// addData(db, &quot;stu&quot;, { &quot;stuId&quot;: 11, &quot;stuName&quot;: &quot;黎明&quot;, &quot;stuAge&quot;: 17 });</span>
                <span class="token comment">// addData(db, &quot;stu&quot;, { &quot;stuId&quot;: 12, &quot;stuName&quot;: &quot;邓超&quot;, &quot;stuAge&quot;: 19 });</span>
                <span class="token comment">// addData(db, &quot;stu&quot;, { &quot;stuId&quot;: 13, &quot;stuName&quot;: &quot;刘翔&quot;, &quot;stuAge&quot;: 15 });</span>
                <span class="token comment">// addData(db, &quot;stu&quot;, { &quot;stuId&quot;: 14, &quot;stuName&quot;: &quot;洋洋&quot;, &quot;stuAge&quot;: 12 });</span>
                <span class="token comment">// addData(db, &quot;stu&quot;, { &quot;stuId&quot;: 15, &quot;stuName&quot;: &quot;林佳音&quot;, &quot;stuAge&quot;: 14 });</span>
                <span class="token comment">// addData(db, &quot;stu&quot;, { &quot;stuId&quot;: 16, &quot;stuName&quot;: &quot;袁进&quot;, &quot;stuAge&quot;: 34 });</span>
                <span class="token comment">// addData(db, &quot;stu&quot;, { &quot;stuId&quot;: 17, &quot;stuName&quot;: &quot;老闫&quot;, &quot;stuAge&quot;: 36 });</span>
                <span class="token comment">// addData(db, &quot;stu&quot;, { &quot;stuId&quot;: 18, &quot;stuName&quot;: &quot;沈爷&quot;, &quot;stuAge&quot;: 34 });</span>

                <span class="token comment">// 调用根据主键来查询的方法</span>
                <span class="token comment">// return getDataByKey(db, &quot;stu&quot;, 3);</span>

                <span class="token comment">// 根据游标查询所有数据</span>
                <span class="token comment">// return cursorGetData(db, &quot;stu&quot;);</span>

                <span class="token comment">// 根据索引来查询某一条数据</span>
                <span class="token comment">// 只是通过索引来查询的话，只会返回满足条件的第一条数据</span>
                <span class="token comment">// return getDataByIndex(db, &quot;stu&quot;, &quot;stuAge&quot;, 18);</span>

                <span class="token comment">// 根据索引和游标来进行查询</span>
                <span class="token comment">// return getDataByIndex(db, &quot;stu&quot;, &quot;stuAge&quot;, 20);</span>

                <span class="token comment">// 测试分页查询</span>
                <span class="token comment">// return cursorGetDataByIndexAndPage(db, &quot;stu&quot;, &quot;&quot;, &quot;&quot;, 2, 5);</span>

                <span class="token comment">// 修改数据</span>
                <span class="token comment">// return updateDB(db, &quot;stu&quot;,  { &quot;stuId&quot;: 4, &quot;stuName&quot;: &quot;谢杰2&quot;, &quot;stuAge&quot;: 28 });</span>

                <span class="token comment">// 删除数据</span>
                <span class="token comment">// return deleteDB(db, &quot;stu&quot;, 4);</span>

                <span class="token comment">// 删除多条指定条件的数据</span>
                <span class="token keyword">return</span> <span class="token function">cursorDelete</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;stuAge&quot;</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">stuInfo</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stuInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">/**
 * 
 * @param {*} dbName 数据库名称
 * @param {*} version 数据库的版本
 */</span>
<span class="token keyword">function</span> <span class="token function">openDB</span><span class="token punctuation">(</span><span class="token parameter">dbName<span class="token punctuation">,</span> version <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> db<span class="token punctuation">;</span> <span class="token comment">// 存储数据库对象</span>
        <span class="token comment">// 打开数据库，如果没有就是创建操作</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>dbName<span class="token punctuation">,</span> version<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 数据库打开或者创建成功的时候</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;数据库打开成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 打开失败</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;数据库打开失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 数据库发生更新的时候</span>
        <span class="token comment">// 1. 版本号更新  2. 添加或者删除了表（对象仓库）的时候</span>
        <span class="token comment">// 当我们第一次调用 open 方法时，会触发这个事件</span>
        <span class="token comment">// 我们在这里来初始化我们的表</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;数据库版本更新&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
            <span class="token comment">// 创建数据仓库（表）</span>
            <span class="token keyword">var</span> objectStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">&quot;stu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">keyPath</span><span class="token operator">:</span> <span class="token string">&quot;stuId&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 这是主键</span>
                <span class="token literal-property property">autoIncrement</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 实现自增</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 创建索引，有了索引之后，查询速度大大增快（类比新华字典）</span>
            objectStore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">&quot;stuId&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;stuId&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">unique</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            objectStore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">&quot;stuName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;stuName&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">unique</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            objectStore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">&quot;stuAge&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;stuAge&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">unique</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 关闭数据库
 * @param {object} db 数据库实例
 */</span>
<span class="token keyword">function</span> <span class="token function">closeDB</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;数据库已关闭&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
* 删除数据库
* @param {object} dbName 数据库名称
*/</span>
<span class="token keyword">function</span> <span class="token function">deleteDBAll</span><span class="token punctuation">(</span><span class="token parameter">dbName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> deleteRequest <span class="token operator">=</span> window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">.</span><span class="token function">deleteDatabase</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    deleteRequest<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;删除失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    deleteRequest<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;删除成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">/**
 * 
 * @param {*} db 数据库实例
 * @param {*} storeName 数据仓库实例（表）
 * @param {*} data 要添加的数据
 */</span>
<span class="token keyword">function</span> <span class="token function">addData</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> storeName<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span>storeName<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;readwrite&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

    request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;数据写入成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;数据写入失败&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 通过主键来读取数据
 * @param {*} db 数据库实例对象
 * @param {*} storeName 数据仓库（表）实例对象
 * @param {*} key 主键
 */</span>
<span class="token keyword">function</span> <span class="token function">getDataByKey</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> storeName<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span>storeName<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>

        request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;数据查询失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 通过主键来读取数据
 * @param {*} db 数据库实例对象
 * @param {*} storeName 数据仓库（表）实例对象
 */</span>
<span class="token keyword">function</span> <span class="token function">getAllData</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> storeName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span>storeName<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;数据查询失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 通过游标（指针）来查询所有的数据
 * @param {*} db 
 * @param {*} storeName 
 */</span>
<span class="token keyword">function</span> <span class="token function">cursorGetData</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> storeName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 用于存放所有的数据</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span>storeName<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;readwrite&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个指针（游标）</span>

        request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> cursor <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
            <span class="token comment">// 查看游标（指针）有没有返回一条数据</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 移动到下一条数据</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 根据索引来查询数据（只会返回一条）
 * @param {*} db 
 * @param {*} storeName 
 * @param {*} indexName 索引名称
 * @param {*} indexValue 索引值
 */</span>
<span class="token keyword">function</span> <span class="token function">getDataByIndex</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> storeName<span class="token punctuation">,</span> indexName<span class="token punctuation">,</span> indexValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span>storeName<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;readwrite&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>indexName<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>indexValue<span class="token punctuation">)</span><span class="token punctuation">;</span>

        request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 根据索引和游标来查询数据
 * @param {*} db 
 * @param {*} storeName 
 * @param {*} indexName 索引名称
 * @param {*} indexValue 索引值
 */</span>
<span class="token keyword">function</span> <span class="token function">getDataByIndex</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> storeName<span class="token punctuation">,</span> indexName<span class="token punctuation">,</span> indexValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 存储所有满足条件的数据</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span>storeName<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;readwrite&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>indexName<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span>IDBKeyRange<span class="token punctuation">.</span><span class="token function">lowerBound</span><span class="token punctuation">(</span>indexValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> cursor <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 通过索引和游标分页查询记录
 * @param {object} db 数据库实例
 * @param {string} storeName 仓库名称
 * @param {string} indexName 索引名称
 * @param {string} indexValue 索引值
 * @param {number} page 页码
 * @param {number} pageSize 查询条数
 */</span>
<span class="token keyword">function</span> <span class="token function">cursorGetDataByIndexAndPage</span><span class="token punctuation">(</span>
    <span class="token parameter">db<span class="token punctuation">,</span>
    storeName<span class="token punctuation">,</span>
    indexName<span class="token punctuation">,</span>
    indexValue<span class="token punctuation">,</span>
    page<span class="token punctuation">,</span>
    pageSize</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 用于存储当前页的分页数据</span>
        <span class="token keyword">var</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个计数器</span>
        <span class="token keyword">var</span> isPass <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 是否要跳过数据</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span>storeName<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;readwrite&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个指针（游标）对象（目前是指向第一条数据）</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> cursor <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
            <span class="token comment">// 接下来有一个很重要的判断，判断是否要跳过一些数据</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>page <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> isPass<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                isPass <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                cursor<span class="token punctuation">.</span><span class="token function">advance</span><span class="token punctuation">(</span><span class="token punctuation">(</span>page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 跳过数据</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                counter<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>counter <span class="token operator">&lt;</span> pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    cursor <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 更新数据
 * @param {object} db 数据库实例
 * @param {string} storeName 仓库名称
 * @param {object} data 数据
 */</span>
<span class="token keyword">function</span> <span class="token function">updateDB</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> storeName<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span>storeName<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;readwrite&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;更新数据成功&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
* 通过主键删除数据
* @param {object} db 数据库实例
* @param {string} storeName 仓库名称
* @param {object} id 主键值
*/</span>
<span class="token keyword">function</span> <span class="token function">deleteDB</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> storeName<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> db
            <span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span>storeName<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;readwrite&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

        request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;删除数据成功&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;删除数据失败&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token comment">/**
 * 通过索引和游标删除指定的数据
 * @param {object} db 数据库实例
 * @param {string} storeName 仓库名称
 * @param {string} indexName 索引名
 * @param {object} indexValue 索引值
 */</span>
 <span class="token keyword">function</span> <span class="token function">cursorDelete</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> storeName<span class="token punctuation">,</span> indexName<span class="token punctuation">,</span> indexValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span>storeName<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;readwrite&quot;</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>indexName<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span>IDBKeyRange<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>indexValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> cursor <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>cursor<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">var</span> deleteRequest <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                deleteRequest<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;删除数据成功&quot;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
</code></pre></div><p>-<em>EOF</em>-</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/quweiqian/interview/frontend-interview-browser-master/5.html" class="prev">
        WebSQL
      </a></span> <span class="next"><a href="/quweiqian/interview/frontend-interview-browser-master/7.html">
        File API
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/quweiqian/assets/js/app.d9b1c135.js" defer></script><script src="/quweiqian/assets/js/4.af0a715f.js" defer></script><script src="/quweiqian/assets/js/220.044f1fd7.js" defer></script>
  </body>
</html>
