(window.webpackJsonp=window.webpackJsonp||[]).push([[211],{579:function(t,a,s){"use strict";s.r(a);var e=s(10),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"jwt"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jwt"}},[t._v("#")]),t._v(" jwt")]),t._v(" "),a("h2",{attrs:{id:"概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),a("p",[t._v("回顾登录的流程：")]),t._v(" "),a("img",{attrs:{src:"http://mdrs.yuanjin.tech/img/image-20200417161950450.png",alt:"img",align:"left"}}),t._v(" "),a("p",[t._v("接下来的问题是：这个出入证（令牌）里面到底存啥？")]),t._v(" "),a("p",[t._v("一种比较简单的办法就是直接存储用户信息的JSON串，这会造成下面的几个问题：")]),t._v(" "),a("ul",[a("li",[t._v("非浏览器环境，如何在令牌中记录过期时间")]),t._v(" "),a("li",[t._v("如何防止令牌被伪造")])]),t._v(" "),a("p",[t._v("JWT就是为了解决这些问题出现的。")]),t._v(" "),a("p",[t._v("JWT全称"),a("code",[t._v("Json Web Token")]),t._v("，本质就是一个字符串")]),t._v(" "),a("p",[t._v("它要解决的问题，就是在互联网环境中，提供"),a("strong",[t._v("统一的、安全的")]),t._v("令牌格式")]),t._v(" "),a("p",[t._v("因此，jwt只是一个令牌格式而已，你可以把它存储到cookie，也可以存储到localstorage，没有任何限制！")]),t._v(" "),a("p",[t._v("同样的，对于传输，你可以使用任何传输方式来传输jwt，一般来说，我们会使用消息头来传输它")]),t._v(" "),a("p",[t._v("比如，当登录成功后，服务器可以给客户端响应一个jwt：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("HTTP/1.1 200 OK\n...\nset-cookie:token=jwt令牌\nauthentication:jwt令牌\n...\n\n{..., token:jwt令牌}\n")])])]),a("p",[t._v("可以看到，jwt令牌可以出现在响应的任何一个地方，客户端和服务器自行约定即可。")]),t._v(" "),a("blockquote",[a("p",[t._v("当然，它也可以出现在响应的多个地方，比如为了充分利用浏览器的cookie，同时为了照顾其他设备，也可以让jwt出现在"),a("code",[t._v("set-cookie")]),t._v("和"),a("code",[t._v("authorization或body")]),t._v("中，尽管这会增加额外的传输量。")])]),t._v(" "),a("p",[t._v("当客户端拿到令牌后，它要做的只有一件事：存储它。")]),t._v(" "),a("p",[t._v("你可以存储到任何位置，比如手机文件、PC文件、localstorage、cookie")]),t._v(" "),a("p",[t._v("当后续请求发生时，你只需要将它作为请求的一部分发送到服务器即可。")]),t._v(" "),a("p",[t._v("虽然jwt没有明确要求应该如何附带到请求中，但通常我们会使用如下的格式：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("GET /api/resources HTTP/1.1\n...\nauthorization: bearer jwt令牌\n...\n")])])]),a("p",[t._v("这样一来，服务器就能够收到这个令牌了，通过对令牌的验证，即可知道该令牌是否有效。")]),t._v(" "),a("p",[t._v("它们的完整交互流程是非常简单清晰的")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://mdrs.yuanjin.tech/img/image-20200422172837190.png",alt:"image-20200422172837190"}})]),t._v(" "),a("h2",{attrs:{id:"令牌的组成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#令牌的组成"}},[t._v("#")]),t._v(" 令牌的组成")]),t._v(" "),a("p",[t._v("为了保证令牌的安全性，jwt令牌由三个部分组成，分别是：")]),t._v(" "),a("ol",[a("li",[t._v("header：令牌头部，记录了整个令牌的类型和签名算法")]),t._v(" "),a("li",[t._v("payload：令牌负荷，记录了保存的主体信息，比如你要保存的用户信息就可以放到这里")]),t._v(" "),a("li",[t._v("signature：令牌签名，按照头部固定的签名算法对整个令牌进行签名，该签名的作用是：保证令牌不被伪造和篡改")])]),t._v(" "),a("p",[t._v("它们组合而成的完整格式是："),a("code",[t._v("header.payload.signature")])]),t._v(" "),a("p",[t._v("比如，一个完整的jwt令牌如下：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIiLCJpYXQiOjE1ODc1NDgyMTV9.BCwUy3jnUQ_E6TqCayc7rCHkx-vxxdagUwPOWqwYCFc\n")])])]),a("p",[t._v("它各个部分的值分别是：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("header：eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9")])]),t._v(" "),a("li",[a("code",[t._v("payload：eyJmb28iOiJiYXIiLCJpYXQiOjE1ODc1NDgyMTV9")])]),t._v(" "),a("li",[a("code",[t._v("signature: BCwUy3jnUQ_E6TqCayc7rCHkx-vxxdagUwPOWqwYCFc")])])]),t._v(" "),a("p",[t._v("下面分别对每个部分进行说明")]),t._v(" "),a("h3",{attrs:{id:"header"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#header"}},[t._v("#")]),t._v(" header")]),t._v(" "),a("p",[t._v("它是令牌头部，记录了整个令牌的类型和签名算法")]),t._v(" "),a("p",[t._v("它的格式是一个"),a("code",[t._v("json")]),t._v("对象，如下：")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"alg"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HS256"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"typ"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"JWT"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("该对象记录了：")]),t._v(" "),a("ul",[a("li",[t._v("alg：signature部分使用的签名算法，通常可以取两个值\n"),a("ul",[a("li",[t._v("HS256：一种对称加密算法，使用同一个秘钥对signature加密解密")]),t._v(" "),a("li",[t._v("RS256：一种非对称加密算法，使用私钥签名，公钥验证")])])]),t._v(" "),a("li",[t._v("typ：整个令牌的类型，固定写"),a("code",[t._v("JWT")]),t._v("即可")])]),t._v(" "),a("p",[t._v("设置好了"),a("code",[t._v("header")]),t._v("之后，就可以生成"),a("code",[t._v("header")]),t._v("部分了")]),t._v(" "),a("p",[t._v("具体的生成方式及其简单，就是把"),a("code",[t._v("header")]),t._v("部分使用"),a("code",[t._v("base64 url")]),t._v("编码即可")]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("base64 url")]),t._v("不是一个加密算法，而是一种编码方式，它是在"),a("code",[t._v("base64")]),t._v("算法的基础上对"),a("code",[t._v("+")]),t._v("、"),a("code",[t._v("=")]),t._v("、"),a("code",[t._v("/")]),t._v("三个字符做出特殊处理的算法")]),t._v(" "),a("p",[t._v("而"),a("code",[t._v("base64")]),t._v("是使用64个可打印字符来表示一个二进制数据，具体的做法参考"),a("a",{attrs:{href:"https://baike.baidu.com/item/base64/8545775?fr=aladdin",target:"_blank",rel:"noopener noreferrer"}},[t._v("百度百科"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("浏览器提供了"),a("code",[t._v("btoa")]),t._v("函数，可以完成这个操作：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("btoa")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"alg"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HS256"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"typ"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"JWT"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 得到字符串：eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9")]),t._v("\n")])])]),a("p",[t._v("同样的，浏览器也提供了"),a("code",[t._v("atob")]),t._v("函数，可以对其进行解码：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("atob")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// 得到字符串：{"alg":"HS256","typ":"JWT"}')]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("nodejs中没有提供这两个函数，可以安装第三方库"),a("code",[t._v("atob")]),t._v("和"),a("code",[t._v("bota")]),t._v("搞定")]),t._v(" "),a("p",[t._v("或者，手动搞定")])]),t._v(" "),a("h3",{attrs:{id:"payload"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#payload"}},[t._v("#")]),t._v(" payload")]),t._v(" "),a("p",[t._v("这部分是jwt的主体信息，它仍然是一个JSON对象，它可以包含以下内容：")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ss"')]),t._v("："),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"发行者"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"iat"')]),t._v("："),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"发布时间"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"exp"')]),t._v("："),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"到期时间"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sub"')]),t._v("："),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"主题"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"aud"')]),t._v("："),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"听众"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nbf"')]),t._v("："),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"在此之前不可用"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jti"')]),t._v("："),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"JWT ID"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("以上属性可以全写，也可以一个都不写，它只是一个规范，就算写了，也需要你在将来验证这个jwt令牌时手动处理才能发挥作用")]),t._v(" "),a("p",[t._v("上述属性表达的含义分别是：")]),t._v(" "),a("ul",[a("li",[t._v("ss：发行该jwt的是谁，可以写公司名字，也可以写服务名称")]),t._v(" "),a("li",[t._v("iat：该jwt的发放时间，通常写当前时间的时间戳")]),t._v(" "),a("li",[t._v("exp：该jwt的到期时间，通常写时间戳")]),t._v(" "),a("li",[t._v("sub：该jwt是用于干嘛的")]),t._v(" "),a("li",[t._v("aud：该jwt是发放给哪个终端的，可以是终端类型，也可以是用户名称，随意一点")]),t._v(" "),a("li",[t._v("nbf：一个时间点，在该时间点到达之前，这个令牌是不可用的")]),t._v(" "),a("li",[t._v("jti：jwt的唯一编号，设置此项的目的，主要是为了防止重放攻击（重放攻击是在某些场景下，用户使用之前的令牌发送到服务器，被服务器正确的识别，从而导致不可预期的行为发生）")])]),t._v(" "),a("p",[t._v("可是到现在，看了半天，没有出现我想要写入的数据啊😂")]),t._v(" "),a("p",[t._v("当用户登陆成功之后，我可能需要把用户的一些信息写入到jwt令牌中，比如用户id、账号等等（密码就算了😳）")]),t._v(" "),a("p",[t._v("其实很简单，payload这一部分只是一个json对象而已，你可以向对象中加入任何想要加入的信息")]),t._v(" "),a("p",[t._v("比如，下面的json对象仍然是一个有效的payload")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"foo"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bar"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"iat"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1587548215")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("code",[t._v("foo: bar")]),t._v("是我们自定义的信息，"),a("code",[t._v("iat: 1587548215")]),t._v("是jwt规范中的信息")]),t._v(" "),a("p",[t._v("最终，payload部分和header一样，需要通过"),a("code",[t._v("base64 url")]),t._v("编码得到：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("btoa")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"foo"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bar"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"iat"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1587548215")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 得到字符串：eyJmb28iOiJiYXIiLCJpYXQiOjE1ODc1NDgyMTV9")]),t._v("\n")])])]),a("h3",{attrs:{id:"signature"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#signature"}},[t._v("#")]),t._v(" signature")]),t._v(" "),a("p",[t._v("这一部分是jwt的签名，正是它的存在，保证了整个jwt不被篡改")]),t._v(" "),a("p",[t._v("这部分的生成，是对前面两个部分的编码结果，按照头部指定的方式进行加密")]),t._v(" "),a("p",[t._v("比如：头部指定的加密方法是"),a("code",[t._v("HS256")]),t._v("，前面两部分的编码结果是"),a("code",[t._v("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIiLCJpYXQiOjE1ODc1NDgyMTV9")])]),t._v(" "),a("p",[t._v("则第三部分就是用对称加密算法"),a("code",[t._v("HS256")]),t._v("对字符串"),a("code",[t._v("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIiLCJpYXQiOjE1ODc1NDgyMTV9")]),t._v("进行加密，当然你得指定一个秘钥，比如"),a("code",[t._v("shhhhh")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HS256")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIiLCJpYXQiOjE1ODc1NDgyMTV9")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"shhhhh"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 得到：BCwUy3jnUQ_E6TqCayc7rCHkx-vxxdagUwPOWqwYCFc")]),t._v("\n")])])]),a("p",[t._v("最终，将三部分组合在一起，就得到了完整的jwt")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIiLCJpYXQiOjE1ODc1NDgyMTV9.BCwUy3jnUQ_E6TqCayc7rCHkx-vxxdagUwPOWqwYCFc\n")])])]),a("p",[t._v("由于签名使用的秘钥保存在服务器，这样一来，客户端就无法伪造出签名，因为它拿不到秘钥。")]),t._v(" "),a("p",[t._v("换句话说，之所以说无法伪造jwt，就是因为第三部分的存在。")]),t._v(" "),a("p",[t._v("而前面两部分并没有加密，只是一个编码结果而已，可以认为几乎是明文传输")]),t._v(" "),a("blockquote",[a("p",[t._v("这不会造成太大的问题，因为既然用户登陆成功了，它当然有权力查看自己的用户信息")]),t._v(" "),a("p",[t._v("甚至在某些网站，用户的基本信息可以被任何人查看")]),t._v(" "),a("p",[t._v("你要保证的，是不要把敏感的信息存放到jwt中，比如密码")])]),t._v(" "),a("p",[t._v("jwt的"),a("code",[t._v("signature")]),t._v("可以保证令牌不被伪造，那如何保证令牌不被篡改呢？")]),t._v(" "),a("p",[t._v("比如，某个用户登陆成功了，获得了jwt，但他人为的篡改了"),a("code",[t._v("payload")]),t._v("，比如把自己的账户余额修改为原来的两倍，然后重新编码出"),a("code",[t._v("payload")]),t._v("发送到服务器，服务器如何得知这些信息被篡改过了呢？")]),t._v(" "),a("p",[t._v("这就要说到令牌的验证了")]),t._v(" "),a("h2",{attrs:{id:"令牌的验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#令牌的验证"}},[t._v("#")]),t._v(" 令牌的验证")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://mdrs.yuanjin.tech/img/image-20200422172837190.png",alt:"image-20200422172837190"}})]),t._v(" "),a("p",[t._v("令牌在服务器组装完成后，会以任意的方式发送到客户端")]),t._v(" "),a("p",[t._v("客户端会把令牌保存起来，后续的请求会将令牌发送给服务器")]),t._v(" "),a("p",[t._v("而服务器需要验证令牌是否正确，如何验证呢？")]),t._v(" "),a("p",[t._v("首先，服务器要验证这个令牌是否被篡改过，验证方式非常简单，就是对"),a("code",[t._v("header+payload")]),t._v("用同样的秘钥和加密算法进行重新加密")]),t._v(" "),a("p",[t._v("然后把加密的结果和传入jwt的"),a("code",[t._v("signature")]),t._v("进行对比，如果完全相同，则表示前面两部分没有动过，就是自己颁发的，如果不同，肯定是被篡改过了。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("传入的header.传入的payload.传入的signature\n新的signature = header中的加密算法(传入的header.传入的payload, 秘钥)\n验证：新的signature == 传入的signature\n")])])]),a("p",[t._v("当令牌验证为没有被篡改后，服务器可以进行其他验证：比如是否过期、听众是否满足要求等等，这些就视情况而定了")]),t._v(" "),a("p",[t._v("注意：这些验证都需要服务器手动完成，没有哪个服务器会给你进行自动验证，当然，你可以借助第三方库来完成这些操作")]),t._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("p",[t._v("最后，总结一下jwt的特点：")]),t._v(" "),a("ul",[a("li",[t._v("jwt本质上是一种令牌格式。它和终端设备无关，同样和服务器无关，甚至与如何传输无关，它只是规范了令牌的格式而已")]),t._v(" "),a("li",[t._v("jwt由三部分组成：header、payload、signature。主体信息在payload")]),t._v(" "),a("li",[t._v("jwt难以被篡改和伪造。这是因为有第三部分的签名存在。")])]),t._v(" "),a("h2",{attrs:{id:"面试题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#面试题"}},[t._v("#")]),t._v(" 面试题")]),t._v(" "),a("p",[t._v("请阐述JWT的令牌格式")]),t._v(" "),a("blockquote",[a("p",[t._v("参考答案：")]),t._v(" "),a("p",[t._v("token 分为三段，分别是 header、payload、signature")]),t._v(" "),a("p",[t._v("其中，header 标识签名算法和令牌类型；payload 标识主体信息，包含令牌过期时间、发布时间、发行者、主体内容等；signature 是使用特定的算法对前面两部分进行加密，得到的加密结果。")]),t._v(" "),a("p",[t._v("token 有防篡改的特点，如果攻击者改动了前面两个部分，就会导致和第三部分对应不上，使得 token 失效。而攻击者不知道加密秘钥，因此又无法修改第三部分的值。")]),t._v(" "),a("p",[t._v("所以，在秘钥不被泄露的前提下，一个验证通过的 token 是值得被信任的。")])])])}),[],!1,null,null,null);a.default=n.exports}}]);