(window.webpackJsonp=window.webpackJsonp||[]).push([[472],{841:function(t,s,a){"use strict";a.r(s);var _=a(10),v=Object(_.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"pnpm-原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pnpm-原理"}},[t._v("#")]),t._v(" pnpm 原理")]),t._v(" "),s("h2",{attrs:{id:"概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[t._v("#")]),t._v(" 概念")]),t._v(" "),s("blockquote",[s("p",[t._v("要彻底理解pnpm是怎么做的，需要有一些操作系统知识")])]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("文件的本质")])])]),t._v(" "),s("p",[t._v("在操作系统中，文件实际上是一个指针，只不过它指向的不是内存地址，而是一个外部存储地址（这里的外部存储可以是硬盘、U盘、甚至是网络）")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qwq9527.gitee.io/resource/imgs/2019-12-31-16-29-21.png",alt:""}})]),t._v(" "),s("p",[t._v("当我们删除文件时，删除的实际上是指针，因此，无论删除多么大的文件，速度都非常快。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qwq9527.gitee.io/resource/imgs/2019-12-31-16-29-43.png",alt:""}})]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[s("strong",[t._v("文件的拷贝")])])]),t._v(" "),s("p",[t._v("如果你复制一个文件，是将该文件指针指向的内容进行复制，然后产生一个新文件指向新的内容")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qwq9527.gitee.io/resource/imgs/2019-12-31-16-30-25.png",alt:""}})]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[s("strong",[t._v("硬链接 hard link")])])]),t._v(" "),s("p",[t._v("硬链接的概念来自于 Unix 操作系统，它是指将一个文件A指针复制到另一个文件B指针中，文件B就是文件A的硬链接")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qwq9527.gitee.io/resource/imgs/2019-12-31-16-33-59.png",alt:""}})]),t._v(" "),s("div",{staticClass:"language-plaintext extra-class"},[s("pre",{pre:!0,attrs:{class:"language-plaintext"}},[s("code",[t._v("例子：\nD:\\abc\\1.txt\n硬链接\nD:\\123.txt\n例中 1.txt 或者 123.txt其中一个进行修改，另一个也会改变，删除其中一个文件，另一个打开依旧还有，和对象的引用概念相似，修改的是磁盘内容。都删掉，数据依然还在，只是没有连接，通过数据恢复技术还能还原，但是经常使用，数据覆盖了，数据可能就没了\n")])])]),s("p",[t._v("通过硬链接，不会产生额外的磁盘占用，并且，两个文件都能找到相同的磁盘内容")]),t._v(" "),s("p",[t._v("硬链接的数量没有限制，可以为同一个文件产生多个硬链接")]),t._v(" "),s("p",[t._v("windows Vista操作系统开始，支持了创建硬链接的操作，在cmd中使用下面的命令可以创建硬链接")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("mklink /h 链接名称 目标文件\n")])])]),s("blockquote",[s("p",[s("em",[t._v("操作系统看不出来，感觉是两个，假设1G文件创建了硬链接，看上去是占用2G空间，实际上是1G，感觉很神奇!")])]),t._v(" "),s("div",{staticClass:"language-plaintext extra-class"},[s("pre",{pre:!0,attrs:{class:"language-plaintext"}},[s("code",[t._v("D:\\CODE\\2023_qwq\\test\\testlink\\temp>mklink /h ..\\bbb.txt a.txt                  \n为 ..\\bbb.txt <<===>> a.txt 创建了硬链接\n")])])])]),t._v(" "),s("p",[t._v("由于文件夹（目录）不存在文件内容，所以文件夹（目录）不能创建硬链接")]),t._v(" "),s("blockquote",[s("p",[t._v("由于种种原因，在windows操作系统中，通常不要跨越盘符创建硬链接")])]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[s("strong",[t._v("符号链接 symbol link")])])]),t._v(" "),s("p",[t._v("符号链接又称为软连接，如果为某个文件或文件夹A创建符号连接B，则B指向A。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qwq9527.gitee.io/resource/imgs/2019-12-31-16-46-57.png",alt:""}})]),t._v(" "),s("p",[t._v("windows Vista操作系统开始，支持了创建符号链接的操作，在cmd中使用下面的命令可以创建符号链接：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("mklink /d 链接名称 目标文件\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /d表示创建的是目录的符号链接，不写则是文件的符号链接")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("早期的windows系统不支持符号链接，但它提供了一个工具junction来达到类似的功能")])]),t._v(" "),s("p",[s("strong",[t._v("符号链接和硬链接的区别")])]),t._v(" "),s("ol",[s("li",[t._v("硬链接仅能链接文件，而符号链接可以链接目录")]),t._v(" "),s("li",[t._v("硬链接在链接完成后仅和文件内容关联，和之前链接的文件没有任何关系。而符号链接始终和之前链接的文件关联，和文件内容不直接相关")])]),t._v(" "),s("ol",{attrs:{start:"5"}},[s("li",[s("strong",[t._v("快捷方式")])])]),t._v(" "),s("p",[t._v("快捷方式类似于符号链接，是windows系统早期就支持的链接方式。")]),t._v(" "),s("p",[t._v("它不仅仅是一个指向其他文件或目录的指针，其中还包含了各种信息：如权限、兼容性启动方式等其他各种属性")]),t._v(" "),s("p",[t._v("由于快捷方式是windows系统独有的，在跨平台的应用中一般不会使用")]),t._v(" "),s("ol",{attrs:{start:"6"}},[s("li",[s("strong",[t._v("node环境对硬链接和符号链接的处理")])])]),t._v(" "),s("p",[s("strong",[t._v("硬链接")]),t._v("：硬链接是一个实实在在的文件，node不对其做任何特殊处理，也无法区别对待，实际上，node根本无从知晓该文件是不是一个硬链接")]),t._v(" "),s("p",[s("strong",[t._v("符号链接")]),t._v("：由于符号链接指向的是另一个文件或目录，当node执行符号链接下的JS文件时，会使用原始路径。")]),t._v(" "),s("h2",{attrs:{id:"pnpm原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pnpm原理"}},[t._v("#")]),t._v(" pnpm原理")]),t._v(" "),s("p",[t._v("pnpm使用符号链接和硬链接来构建node_modules目录")]),t._v(" "),s("p",[t._v("下面用一个例子来说明它的构建方式")]),t._v(" "),s("p",[t._v("假设两个包a和b，a依赖b：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qwq9527.gitee.io/resource/imgs/2019-12-31-17-50-59.png",alt:""}})]),t._v(" "),s("p",[t._v("假设我们的工程为proj，直接依赖a，则安装时，pnpm会做下面的处理")]),t._v(" "),s("ol",[s("li",[t._v("查询依赖关系，得到最终要安装的包：a和b")]),t._v(" "),s("li",[t._v("查看a和b是否已经有缓存，如果没有，下载到缓存中，如果有，则进入下一步")]),t._v(" "),s("li",[t._v("创建 node_modules 目录，并对目录进行结构初始化")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qwq9527.gitee.io/resource/imgs/2019-12-31-18-09-53.png",alt:""}})]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[t._v("从缓存的对应包中使用硬链接放置文件到相应包代码目录中")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qwq9527.gitee.io/resource/imgs/2019-12-31-18-14-31.png",alt:""}})]),t._v(" "),s("ol",{attrs:{start:"5"}},[s("li",[t._v("使用符号链接，将每个包的"),s("strong",[t._v("直接依赖")]),t._v("放置到自己的目录中")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qwq9527.gitee.io/resource/imgs/2019-12-31-18-19-48.png",alt:""}})]),t._v(" "),s("p",[t._v("这样做的目的，是为了保证a的代码在执行过程中，可以读取到它们的直接依赖")]),t._v(" "),s("ol",{attrs:{start:"6"}},[s("li",[t._v("新版本的pnpm为了解决一些书写不规范的包（读取间接依赖）的问题，又将所有的工程非直接依赖，使用符号链接加入到了 .pnpm/node_modules 中")])]),t._v(" "),s("p",[t._v("在本例中好像没有必要，但是如果b依赖c，a又要直接用c，这种不规范的用法现在pnpm通过这种方式支持了。")]),t._v(" "),s("blockquote",[s("p",[t._v("但对于那些使用绝对路径的奇葩写法，可能永远也无法支持")])]),t._v(" "),s("ol",{attrs:{start:"7"}},[s("li",[t._v("在工程的node_modules目录中使用符号链接，放置直接依赖")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qwq9527.gitee.io/resource/imgs/2019-12-31-18-27-19.png",alt:""}})]),t._v(" "),s("ol",{attrs:{start:"8"}},[s("li",[t._v("完成")])])])}),[],!1,null,null,null);s.default=v.exports}}]);