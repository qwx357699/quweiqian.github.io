(window.webpackJsonp=window.webpackJsonp||[]).push([[520],{897:function(t,a,s){"use strict";s.r(a);var e=s(10),r=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"优化loader性能-ignore"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优化loader性能-ignore"}},[t._v("#")]),t._v(" 优化loader性能 {ignore}")]),t._v(" "),a("h2",{attrs:{id:"进一步限制loader的应用范围"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进一步限制loader的应用范围"}},[t._v("#")]),t._v(" 进一步限制loader的应用范围")]),t._v(" "),a("p",[t._v("思路是：对于某些库，不使用loader")]),t._v(" "),a("p",[t._v("例如：babel-loader可以转换ES6或更高版本的语法，可是有些库本身就是用ES5语法书写的，不需要转换，使用babel-loader反而会浪费构建时间")]),t._v(" "),a("p",[t._v("lodash就是这样的一个库")]),t._v(" "),a("blockquote",[a("p",[t._v("lodash是在ES5之前出现的库，使用的是ES3语法")])]),t._v(" "),a("p",[t._v("通过"),a("code",[t._v("module.rule.exclude")]),t._v("或"),a("code",[t._v("module.rule.include")]),t._v("，排除或仅包含需要应用loader的场景")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("module")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("rules")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("test")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\.js$")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("exclude")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("lodash")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"babel-loader"')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("如果暴力一点，甚至可以排除掉"),a("code",[t._v("node_modules")]),t._v("目录中的模块，或仅转换"),a("code",[t._v("src")]),t._v("目录的模块")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("module")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("rules")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("test")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\.js$")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("include")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\.\\/src")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//或")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// exclude: /node_modules/,  // webpack一些代码还没排除")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"babel-loader"')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("这种做法是对loader的范围进行进一步的限制，和noParse不冲突，想想看，为什么不冲突")])]),t._v(" "),a("h2",{attrs:{id:"缓存loader的结果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓存loader的结果"}},[t._v("#")]),t._v(" 缓存loader的结果")]),t._v(" "),a("p",[t._v("我们可以基于一种假设：如果某个文件内容不变，经过相同的loader解析后，解析后的结果也不变")]),t._v(" "),a("p",[t._v("于是，可以将loader的解析结果保存下来，让后续的解析直接使用保存的结果")]),t._v(" "),a("p",[a("code",[t._v("cache-loader")]),t._v("可以实现这样的功能")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("module")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("rules")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("test")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\.js$")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            \t"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("loader")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cache-loader"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            \t"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("options")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n              \t\t"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("cacheDirectory")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./cache"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 缓存目录")]),t._v("\n            \t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("loaders\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("有趣的是，"),a("code",[t._v("cache-loader")]),t._v("放到最前面，却能够决定后续的loader是否运行")]),t._v(" "),a("p",[t._v("实际上，loader的运行过程中，还包含一个过程，即"),a("code",[t._v("pitch")])]),t._v(" "),a("h3",{attrs:{id:"pitch-是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pitch-是什么"}},[t._v("#")]),t._v(" pitch 是什么？")]),t._v(" "),a("p",[a("em",[t._v("loader")]),t._v(" 函数的一个静态函数。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("loader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("new source")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// loader 函数还有一个静态方法配置 pitch函数")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 接收要解析的文件路径参数")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 函数可以不返回运行结果")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果返回，返回源代码，字符串")]),t._v("\nloader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("pitch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("filePath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可返回可不返回")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果返回，返回源代码")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" loader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"ptich-的过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ptich-的过程"}},[t._v("#")]),t._v(" ptich 的过程")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://qwq9527.gitee.io/resource/imgs/2020-02-21-13-32-36.png",alt:""}})]),t._v(" "),a("p",[t._v("之前讲的是图中下部分的流程，之前还有一部分流程。比如 "),a("em",[t._v("indexe.js")]),t._v(" 文件解析流程：")]),t._v(" "),a("p",[t._v("先把文件路径 "),a("em",[t._v("path")]),t._v(" 交给 "),a("em",[t._v("loader1")]),t._v(" 的 "),a("em",[t._v("pitch")]),t._v(" 函数来运行，如过没有返回结果，把 "),a("em",[t._v("path")]),t._v(" 交给 "),a("em",[t._v("loader2")]),t._v(",如果 "),a("em",[t._v("loader2")]),t._v(" 的 "),a("em",[t._v("pitch")]),t._v(" 运行后也没结果，继续交给 "),a("em",[t._v("loader3")]),t._v(", 如果 "),a("em",[t._v("loader3")]),t._v(" 的 "),a("em",[t._v("pitch")]),t._v(" 运行也没结果，就直接读取资源内容，把内容交给"),a("em",[t._v("loader3")]),t._v(", 后续流程和之前一样了。")]),t._v(" "),a("h3",{attrs:{id:"pitch-的作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pitch-的作用"}},[t._v("#")]),t._v(" pitch 的作用")]),t._v(" "),a("p",[a("em",[t._v("pitch")]),t._v(" 有什么用呢？")]),t._v(" "),a("p",[a("em",[t._v("pitch")]),t._v(" 的好处在于"),a("strong",[t._v("通过是否返回，来控制下一步到哪")]),t._v("。")]),t._v(" "),a("p",[t._v("比如说 "),a("em",[t._v("loader1.pitch")]),t._v(" 运行后返回了，那么直接结束了。把返回的代码 "),a("em",[t._v("source")]),t._v(" 交给下一步，当前结束了。如果 "),a("em",[t._v("loader1.pitch")]),t._v(" 没有返回，"),a("em",[t._v("loader2.pitch")]),t._v(" 有返回值，那么它将会把返回值交给 "),a("em",[t._v("loader1")]),t._v(", "),a("em",[t._v("loader1")]),t._v(" 转换过后结束。")]),t._v(" "),a("p",[a("strong",[t._v("因此，"),a("em",[t._v("cache - loader")]),t._v(" 是怎么处理的呢 ?")])]),t._v(" "),a("ul",[a("li",[a("p",[a("em",[t._v("cache - loader")]),t._v(" 放在第一个位置，首先进入 "),a("em",[t._v("cache - loader.pitch")]),t._v(" 函数，它看下"),a("strong",[t._v("现在有没有缓存")]),t._v("，如果"),a("strong",[t._v("没有缓存就不返回")]),t._v("，经过正常的流程。流程走到 "),a("em",[t._v("loader1")]),t._v(" 也就是 "),a("strong",[t._v("cache-loader")]),t._v(", 它就会把内容缓存下来，结束。")])]),t._v(" "),a("li",[a("p",[t._v("第二次的时候，首先进入 "),a("em",[t._v("cache - loader.pitch")]),t._v(" 函数，发现有缓存，就直接读取对应的缓存文件，把文件内容作为结果返回。就不会继续后续的过程了。")])])]),t._v(" "),a("p",[a("code",[t._v("cache-loader")]),t._v("还可以实现各自自定义的配置，具体方式见文档")]),t._v(" "),a("blockquote",[a("p",[a("em",[t._v("cache-loader")]),t._v(" 只同步到 "),a("em",[t._v("wepack4")]),t._v(" ,"),a("em",[t._v("webpack5")]),t._v(" 中直接使用 "),a("em",[t._v("babel-loader")]),t._v(" 的 "),a("code",[t._v("cacheDirectory:true")]),t._v(" 配置开启")])]),t._v(" "),a("h2",{attrs:{id:"为loader的运行开启多线程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为loader的运行开启多线程"}},[t._v("#")]),t._v(" 为loader的运行开启多线程")]),t._v(" "),a("h3",{attrs:{id:"作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#作用"}},[t._v("#")]),t._v(" 作用")]),t._v(" "),a("p",[a("code",[t._v("thread-loader")]),t._v("会开启一个线程池，线程池中包含适量的线程")]),t._v(" "),a("p",[t._v("它会把后续的loader放到线程池的线程中运行，以提高构建效率")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("线程池：可以想象成一块内存空间，里面包含了很多线程")])]),t._v(" "),a("li",[a("p",[t._v("适量：差不多和多核 "),a("em",[t._v("cup")]),t._v(" 的核数量保持一致就行了")])]),t._v(" "),a("li",[a("p",[a("em",[t._v("thread-loader")]),t._v(" 默认核数量是根据电脑中的核数量配置的，"),a("em",[t._v("nodejs")]),t._v(" 里面可以获取 "),a("em",[t._v("cpu")]),t._v(" 核的数量")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" cpus "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"os"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cpus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cpus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 得到一个数组，每一项是对核的描述, 通过 length 获取核数。")]),t._v("\n")])])])])]),t._v(" "),a("h3",{attrs:{id:"怎么使用呢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#怎么使用呢"}},[t._v("#")]),t._v(" 怎么使用呢？")]),t._v(" "),a("p",[t._v("放置的位置自行决定去试，比如放到开始位置:")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"thread-loader"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("loader")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cache-loader"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("options")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("cacheDirectory")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./cache"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"babel-loader"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("p",[t._v("那么后续的 "),a("em",[t._v("cache-loader")]),t._v(" "),a("em",[t._v("babel - loader")]),t._v(" 都在新线程里面。\n如果放到中间位置：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("loader")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cache-loader"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("options")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("cacheDirectory")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./cache"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"thread-loader"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"babel-loader"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("p",[t._v("那么指的是 "),a("em",[t._v("cache-loader")]),t._v(" 不在新线程里面，"),a("em",[t._v("babel-loader")]),t._v(" 在新线程里面。\n现在的场景放在哪合适？\n放在中间位置比较合适，因为我们主要的开销在于 "),a("em",[t._v("loader")]),t._v(" 的解析，"),a("em",[t._v("cache-loader")]),t._v(" 没有解析源代码，所以 cache-loader 没有必要去新开线程。")]),t._v(" "),a("p",[a("em",[t._v("webpack")]),t._v(" 在 "),a("em",[t._v("js")]),t._v(" 的主线程运行的，进入别的线程，有的东西用不了。")]),t._v(" "),a("p",[t._v("由于后续的 "),a("em",[t._v("loader")]),t._v(" 会放到新的线程中，所以，后续的 "),a("em",[t._v("loader")]),t._v(" 不能：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("使用 webpack api 生成文件")]),t._v(" "),a("blockquote",[a("p",[t._v("比如，之前学的 "),a("code",[t._v("this.emitFile")]),t._v(" 使用不了，换线程后很多 API 都失效了。")])])]),t._v(" "),a("li",[a("p",[t._v("无法使用自定义的 plugin api")]),t._v(" "),a("blockquote",[a("p",[t._v("比如之前学的 "),a("em",[t._v("mini-css-extract-plugin")]),t._v(" 插件，用于提取 "),a("em",[t._v("css")]),t._v(" 文件：")]),t._v(" "),a("p",[t._v("里面提供了一个 "),a("em",[t._v("loader")]),t._v(" 和一个 "),a("em",[t._v("plugin")])]),t._v(" "),a("p",[a("strong",[t._v("plugin")]),t._v("：向 "),a("em",[t._v("webpack")]),t._v(" 注入了一些新的 "),a("em",[t._v("api")])]),t._v(" "),a("p",[a("strong",[t._v("loader")]),t._v("："),a("em",[t._v("loader")]),t._v(" 会使用这些注入的 "),a("em",[t._v("api")])]),t._v(" "),a("p",[t._v("这种 "),a("em",[t._v("loader")]),t._v(" 不能放倒 "),a("em",[t._v("thread-loader")]),t._v(" 后面，会报错的")])])]),t._v(" "),a("li",[a("p",[t._v("无法访问 webpack options")]),t._v(" "),a("blockquote",[a("p",[t._v("是指无法访问 webpack 的配置内容")])])])]),t._v(" "),a("p",[t._v("所以 "),a("em",[t._v("thread-loader")]),t._v(" 后面适合放哪些东西呢？")]),t._v(" "),a("p",[t._v("它非常适合放纯粹的转换代码的 loader ，像 "),a("em",[t._v("babel-loader")]),t._v(" ,它自己有一套完整的东西来解析代码，和 "),a("em",[t._v("webpack")]),t._v(" 是隔开的。")]),t._v(" "),a("p",[t._v("如果要使用 "),a("em",[t._v("thread-loader")]),t._v(" 怎么知道哪些 "),a("em",[t._v("loader")]),t._v(" 纯粹呢？只能靠试。")]),t._v(" "),a("blockquote",[a("p",[t._v("在实际的开发中，可以进行测试，来决定"),a("code",[t._v("thread-loader")]),t._v("放到什么位置")])]),t._v(" "),a("p",[a("strong",[t._v("特别注意")]),t._v("，开启和管理线程需要消耗时间，在小型项目中使用"),a("code",[t._v("thread-loader")]),t._v("反而会增加构建时间")])])}),[],!1,null,null,null);a.default=r.exports}}]);