(window.webpackJsonp=window.webpackJsonp||[]).push([[226],{596:function(t,s,a){"use strict";a.r(s);var n=a(10),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"浮点数精度问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#浮点数精度问题"}},[t._v("#")]),t._v(" 浮点数精度问题")]),t._v(" "),s("h2",{attrs:{id:"经典真题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#经典真题"}},[t._v("#")]),t._v(" 经典真题")]),t._v(" "),s("ul",[s("li",[t._v("为什么 "),s("em",[t._v("console.log(0.2+0.1==0.3)")]),t._v("  得到的值为 "),s("em",[t._v("false")])])]),t._v(" "),s("h2",{attrs:{id:"浮点数精度常见问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#浮点数精度常见问题"}},[t._v("#")]),t._v(" 浮点数精度常见问题")]),t._v(" "),s("p",[t._v("在 "),s("em",[t._v("JavaScript")]),t._v(" 中整数和浮点数都属于 "),s("em",[t._v("number")]),t._v(" 数据类型，所有数字都是以 "),s("em",[t._v("64")]),t._v(" 位浮点数形式储存，即便整数也是如此。 所以我们在打印 "),s("em",[t._v("1.00")]),t._v(" 这样的浮点数的结果是 "),s("em",[t._v("1")]),t._v(" 而非 "),s("em",[t._v("1.00")]),t._v(" 。")]),t._v(" "),s("p",[t._v("在一些特殊的数值表示中，例如金额，这样看上去有点别扭，但是至少值是正确了。")]),t._v(" "),s("p",[t._v("然而要命的是，当浮点数做数学运算的时候，你经常会发现一些问题，举几个例子：")]),t._v(" "),s("p",[s("strong",[t._v("场景一")]),t._v("：进行浮点值运算结果的判断")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 加法 ")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 0.30000000000000004")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.7")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 0.7999999999999999")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 0.6000000000000001")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.22")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2.3200000000000003")]),t._v("\n \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 减法")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.5")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 0.30000000000000004")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.3")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 0.09999999999999998")]),t._v("\n \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 乘法 ")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19.9")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1989.9999999999998")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19.9")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1990")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9.7")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 969.9999999999999")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("39.7")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3970.0000000000005")]),t._v("\n \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 除法 ")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.3")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2.9999999999999996")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.69")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 0.06899999999999999")]),t._v("\n")])])]),s("p",[s("strong",[t._v("场景二")]),t._v("：将小数乘以 "),s("em",[t._v("10")]),t._v(" 的 "),s("em",[t._v("n")]),t._v(" 次方取整")]),t._v(" "),s("p",[t._v("比如将钱币的单位，从元转化成分，经常写出来的是 "),s("em",[t._v("parseInt(yuan*100, 10)")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseInt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.58")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 57")]),t._v("\n")])])]),s("p",[s("strong",[t._v("场景三")]),t._v("：四舍五入保留 "),s("em",[t._v("n")]),t._v(" 位小数")]),t._v(" "),s("p",[t._v("例如我们会写出  "),s("em",[t._v("(number).toFixed(2)")]),t._v("，但是看下面的例子：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.335")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toFixed")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1.33")]),t._v("\n")])])]),s("p",[t._v("在上面的例子中，我们得出的结果是 "),s("em",[t._v("1.33")]),t._v("，而不是预期结果 "),s("em",[t._v("1.34")]),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"为什么会有这样的问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么会有这样的问题"}},[t._v("#")]),t._v(" 为什么会有这样的问题")]),t._v(" "),s("p",[t._v("似乎是不可思议。小学生都会算的题目，"),s("em",[t._v("JavaScript")]),t._v(" 不会？")]),t._v(" "),s("p",[t._v("我们来看看其真正的原因，到底为什么会产生精度丢失的问题呢？")]),t._v(" "),s("p",[t._v("计算机底层只有 "),s("em",[t._v("0")]),t._v(" 和 "),s("em",[t._v("1")]),t._v("， 所以所有的运算最后实际上都是二进制运算。")]),t._v(" "),s("p",[t._v("十进制整数利用辗转相除的方法可以准确地转换为二进制数，但浮点数呢？")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9fc493d0e2e84274b8445d8c5df405ae~tplv-k3u1fbpfcp-watermark.awebp",alt:"img"}}),t._v(" "),s("p",[s("em",[t._v("JavaScript")]),t._v(" 里的数字是采用 "),s("em",[t._v("IEEE 754")]),t._v(" 标准的 "),s("em",[t._v("64")]),t._v(" 位双精度浮点数。")]),t._v(" "),s("p",[t._v("先看下面一张图：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2021-09-29-060439.png",alt:"preview"}})]),t._v(" "),s("p",[t._v("该规范定义了浮点数的格式，对于 "),s("em",[t._v("64")]),t._v(" 位的浮点数在内存中的表示，最高的 "),s("em",[t._v("1")]),t._v(" 位是符号位，接着的 "),s("em",[t._v("11")]),t._v(" 位是指数，剩下的 "),s("em",[t._v("52")]),t._v(" 位为有效数字，具体如下：")]),t._v(" "),s("ul",[s("li",[t._v("符号位 "),s("em",[t._v("S")]),t._v("：第 "),s("em",[t._v("1")]),t._v(" 位是正负数符号位（"),s("em",[t._v("sign")]),t._v("），"),s("em",[t._v("0")]),t._v(" 代表正数，"),s("em",[t._v("1")]),t._v(" 代表负数")]),t._v(" "),s("li",[t._v("指数位 "),s("em",[t._v("E")]),t._v("：中间的 "),s("em",[t._v("11")]),t._v(" 位存储指数（"),s("em",[t._v("exponent")]),t._v("），用来表示次方数")]),t._v(" "),s("li",[t._v("尾数位 "),s("em",[t._v("M")]),t._v("：最后的 "),s("em",[t._v("52")]),t._v(" 位是尾数（"),s("em",[t._v("mantissa")]),t._v("），储存小数部分，超出的部分自动进一舍零")])]),t._v(" "),s("p",[t._v("也就是说，浮点数最终在运算的时候实际上是一个符合该标准的二进制数")]),t._v(" "),s("p",[t._v("符号位决定了一个数的正负，指数部分决定了数值的大小，小数部分决定了数值的精度。")]),t._v(" "),s("p",[s("em",[t._v("IEEE 754")]),t._v(" 规定，有效数字第一位默认总是 "),s("em",[t._v("1")]),t._v("，不保存在 "),s("em",[t._v("64")]),t._v(" 位浮点数之中。也就是说，有效数字总是 "),s("em",[t._v("1.xx…xx")]),t._v(" 的形式，其中 "),s("em",[t._v("xx…xx")]),t._v(" 的部分保存在 "),s("em",[t._v("64")]),t._v(" 位浮点数之中，最长可能为 "),s("em",[t._v("52")]),t._v(" 位。因此，"),s("em",[t._v("JavaScript")]),t._v(" 提供的有效数字最长为 "),s("em",[t._v("53")]),t._v(" 个二进制位（"),s("em",[t._v("64")]),t._v(" 位浮点的后 "),s("em",[t._v("52")]),t._v(" 位 + 有效数字第一位的 "),s("em",[t._v("1")]),t._v("）。")]),t._v(" "),s("p",[t._v("既然限定位数，必然有截断的可能。")]),t._v(" "),s("p",[t._v("我们可以看一个例子：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 0.30000000000000004")]),t._v("\n")])])]),s("p",[t._v("为了验证该例子，我们得先知道怎么将浮点数转换为二进制，整数我们可以用除 "),s("em",[t._v("2")]),t._v(" 取余的方式，小数我们则可以用乘 "),s("em",[t._v("2")]),t._v(" 取整的方式。")]),t._v(" "),s("p",[s("em",[t._v("0.1")]),t._v(" 转换为二进制：")]),t._v(" "),s("p",[s("em",[t._v("0.1 * 2")]),t._v("，值为 "),s("em",[t._v("0.2")]),t._v("，小数部分 "),s("em",[t._v("0.2")]),t._v("，整数部分 "),s("em",[t._v("0")])]),t._v(" "),s("p",[s("em",[t._v("0.2 * 2")]),t._v("，值为 "),s("em",[t._v("0.4")]),t._v("，小数部分 "),s("em",[t._v("0.4")]),t._v("，整数部分 "),s("em",[t._v("0")])]),t._v(" "),s("p",[s("em",[t._v("0.4 * 2")]),t._v("，值为0.8，小数部分0.8，整数部分0")]),t._v(" "),s("p",[s("em",[t._v("0.8 * 2")]),t._v("，值为 "),s("em",[t._v("1.6")]),t._v("，小数部分 "),s("em",[t._v("0.6")]),t._v("，整数部分 "),s("em",[t._v("1")])]),t._v(" "),s("p",[s("em",[t._v("0.6 * 2")]),t._v("，值为 "),s("em",[t._v("1.2")]),t._v("，小数部分 "),s("em",[t._v("0.2")]),t._v("，整数部分 "),s("em",[t._v("1")])]),t._v(" "),s("p",[s("em",[t._v("0.2 * 2")]),t._v("，值为 "),s("em",[t._v("0.4")]),t._v("，小数部分 "),s("em",[t._v("0.4")]),t._v("，整数部分 "),s("em",[t._v("0")])]),t._v(" "),s("p",[t._v("从 "),s("em",[t._v("0.2")]),t._v(" 开始循环")]),t._v(" "),s("p",[s("em",[t._v("0.2")]),t._v("  转换为二进制可以直接参考上述，肯定最后也是一个循环的情况")]),t._v(" "),s("p",[t._v("所以最终我们能得到两个循环的二进制数：")]),t._v(" "),s("p",[s("em",[t._v("0.1：0.0001 1001 1001 1001 1001 1001 1001 1001 1001 1001 1001 1001 1100 ...")])]),t._v(" "),s("p",[s("em",[t._v("0.2：0.0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 ...")])]),t._v(" "),s("p",[t._v("这两个的和的二进制就是：")]),t._v(" "),s("p",[s("em",[t._v("sum：0.0100 1100 1100 1100 1100 1100 1100 1100 1100 1100 1100 1100 1100 1100 ...")])]),t._v(" "),s("p",[t._v("最终我们只能得到和的近似值（按照 "),s("em",[t._v("IEEE 754")]),t._v(" 标准保留 "),s("em",[t._v("52")]),t._v(" 位，按 "),s("em",[t._v("0")]),t._v(" 舍 "),s("em",[t._v("1")]),t._v(" 入来取值），然后转换为十进制数变成：")]),t._v(" "),s("p",[t._v("sum ≈ 0.30000000000000004")]),t._v(" "),s("p",[t._v("再例如：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.335")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toFixed")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1.33")]),t._v("\n")])])]),s("p",[t._v("因为 "),s("em",[t._v("1.335")]),t._v(" 其实是 "),s("em",[t._v("1.33499999999999996447286321199")]),t._v("，"),s("em",[t._v("toFixed")]),t._v(" 虽然是四舍五入，但是是对 "),s("em",[t._v("1.33499999999999996447286321199")]),t._v(" 进行四五入，所以得出 "),s("em",[t._v("1.33")]),t._v("。")]),t._v(" "),s("p",[t._v("在 "),s("em",[t._v("Javascript")]),t._v(" 中，整数精度同样存在问题，先来看看问题：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19571992547450991")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 19571992547450990")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19571992547450991")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19571992547450992")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// true")]),t._v("\n")])])]),s("p",[t._v("同样的原因，在 "),s("em",[t._v("JavaScript")]),t._v(" 中  "),s("em",[t._v("number")]),t._v(" 类型统一按浮点数处理，整数是按最大 "),s("em",[t._v("54")]),t._v(" 位来算，")]),t._v(" "),s("ul",[s("li",[t._v("最大( "),s("em",[t._v("2"),s("sup",[t._v("53")]),t._v(" - 1")]),t._v("，"),s("em",[t._v("Number.MAX_SAFE_INTEGER")]),t._v("、"),s("em",[t._v("9007199254740991")]),t._v(")")]),t._v(" "),s("li",[t._v("最小( "),s("em",[t._v("-(2"),s("sup",[t._v("53")]),t._v(" - 1)")]),t._v("，"),s("em",[t._v("Number.MIN_SAFE_INTEGER")]),t._v("、"),s("em",[t._v("-9007199254740991")]),t._v(")")])]),t._v(" "),s("p",[t._v("所以只要超过这个范围，就会存在被舍去的精度问题。")]),t._v(" "),s("p",[t._v("当然这个问题并不只是在 "),s("em",[t._v("Javascript")]),t._v(" 中才会出现，几乎所有的编程语言都采用了 "),s("em",[t._v("IEEE-754")]),t._v(" 浮点数表示法，任何使用二进制浮点数的编程语言都会有这个问题。")]),t._v(" "),s("p",[t._v("只不过在很多其他语言中已经封装好了方法来避免精度的问题，而 "),s("em",[t._v("JavaScript")]),t._v(" 是一门弱类型的语言，从设计思想上就没有对浮点数有个严格的数据类型，所以精度误差的问题就显得格外突出。")]),t._v(" "),s("p",[t._v("通常这种对精度要求高的计算都应该交给后端去计算和存储，因为后端有成熟的库来解决这种计算问题。")]),t._v(" "),s("p",[t._v("前端也有几个不错的类库：")]),t._v(" "),s("p",[s("em",[s("strong",[t._v("Math.js")])])]),t._v(" "),s("p",[s("em",[t._v("Math.js")]),t._v(" 是专门为 "),s("em",[t._v("JavaScript")]),t._v(" 和 "),s("em",[t._v("Node.js")]),t._v(" 提供的一个广泛的数学库。它具有灵活的表达式解析器，支持符号计算，配有大量内置函数和常量，并提供集成解决方案来处理不同的数据类型。")]),t._v(" "),s("p",[t._v("像数字，大数字（超出安全数的数字），复数，分数，单位和矩阵。 功能强大，易于使用。")]),t._v(" "),s("p",[s("em",[s("strong",[t._v("decimal.js")])])]),t._v(" "),s("p",[t._v("为 "),s("em",[t._v("JavaScript")]),t._v(" 提供十进制类型的任意精度数值。")]),t._v(" "),s("p",[s("em",[s("strong",[t._v("big.js")])])]),t._v(" "),s("p",[t._v("不仅能够支持处理 "),s("em",[t._v("Long")]),t._v(" 类型的数据，也能够准确的处理小数的运算。")]),t._v(" "),s("h2",{attrs:{id:"真题解答"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#真题解答"}},[t._v("#")]),t._v(" 真题解答")]),t._v(" "),s("ul",[s("li",[t._v("为什么 "),s("em",[t._v("console.log(0.2+0.1==0.3)")]),t._v("  得到的值为 "),s("em",[t._v("false")])])]),t._v(" "),s("blockquote",[s("p",[t._v("参考答案：")]),t._v(" "),s("p",[t._v("因为浮点数的计算存在 "),s("em",[t._v("round-off")]),t._v("  问题，也就是浮点数不能够进行精确的计算。并且：")]),t._v(" "),s("ul",[s("li",[t._v("不仅 "),s("em",[t._v("JavaScript")]),t._v("，所有遵循 "),s("em",[t._v("IEEE 754")]),t._v(" 规范的语言都是如此；")]),t._v(" "),s("li",[t._v("在 "),s("em",[t._v("JavaScript")]),t._v(" 中，所有的 "),s("em",[t._v("Number")]),t._v(" 都是以 "),s("em",[t._v("64-bit")]),t._v(" 的双精度浮点数存储的；")]),t._v(" "),s("li",[t._v("双精度的浮点数在这 "),s("em",[t._v("64")]),t._v(" 位上划分为 "),s("em",[t._v("3")]),t._v(" 段，而这 "),s("em",[t._v("3")]),t._v(" 段也就确定了一个浮点数的值，"),s("em",[t._v("64bit")]),t._v(" 的划分是“"),s("em",[t._v("1-11-52")]),t._v("”的模式，具体来说：\n"),s("ul",[s("li",[t._v("就是 "),s("em",[t._v("1")]),t._v(" 位最高位（最左边那一位）表示符号位，"),s("em",[t._v("0")]),t._v(" 表示正，"),s("em",[t._v("1")]),t._v(" 表示负；")]),t._v(" "),s("li",[s("em",[t._v("11")]),t._v(" 位表示指数部分；")]),t._v(" "),s("li",[s("em",[t._v("52")]),t._v(" 位表示尾数部分，也就是有效域部分")])])])])]),t._v(" "),s("p",[t._v("-"),s("em",[t._v("EOF")]),t._v("-")])])}),[],!1,null,null,null);s.default=e.exports}}]);