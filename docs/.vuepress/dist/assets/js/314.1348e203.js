(window.webpackJsonp=window.webpackJsonp||[]).push([[314],{693:function(t,s,a){"use strict";a.r(s);var n=a(10),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"跨域-cors"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#跨域-cors"}},[t._v("#")]),t._v(" 跨域-CORS")]),t._v(" "),s("h2",{attrs:{id:"概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),s("p",[s("code",[t._v("CORS")]),t._v("是基于"),s("code",[t._v("http1.1")]),t._v("的一种跨域解决方案，它的全称是"),s("strong",[t._v("C")]),t._v("ross-"),s("strong",[t._v("O")]),t._v("rigin "),s("strong",[t._v("R")]),t._v("esource "),s("strong",[t._v("S")]),t._v("haring，跨域资源共享。")]),t._v(" "),s("p",[t._v("它的总体思路是："),s("strong",[t._v("如果浏览器要跨域访问服务器的资源，需要获得服务器的允许")])]),t._v(" "),s("p",[s("img",{attrs:{src:"http://mdrs.yuanjin.tech/img/image-20200421152122793.png",alt:"image-20200421152122793"}})]),t._v(" "),s("p",[t._v("而要知道，一个请求可以附带很多信息，从而会对服务器造成不同程度的影响")]),t._v(" "),s("p",[t._v("比如有的请求只是获取一些新闻，有的请求会改动服务器的数据")]),t._v(" "),s("p",[t._v("针对不同的请求**，CORS 规定了三种不同的交互模式**，分别是：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("简单请求")])]),t._v(" "),s("li",[s("strong",[t._v("需要预检的请求")])]),t._v(" "),s("li",[s("strong",[t._v("附带身份凭证的请求")])])]),t._v(" "),s("p",[t._v("这三种模式从上到下层层递进，请求可以做的事越来越多，要求也越来越严格。")]),t._v(" "),s("p",[t._v("下面分别说明三种请求模式的具体规范。")]),t._v(" "),s("h2",{attrs:{id:"简单请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简单请求"}},[t._v("#")]),t._v(" 简单请求")]),t._v(" "),s("p",[t._v("当浏览器端运行了一段 ajax 代码（无论是使用 XMLHttpRequest 还是 fetch api），浏览器会首先判断它属于哪一种请求模式")]),t._v(" "),s("h3",{attrs:{id:"简单请求的判定"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简单请求的判定"}},[t._v("#")]),t._v(" 简单请求的判定")]),t._v(" "),s("p",[t._v("当请求"),s("strong",[t._v("同时满足")]),t._v("以下条件时，浏览器会认为它是一个简单请求：")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("请求方法属于下面的一种：")])]),t._v(" "),s("ul",[s("li",[t._v("get")]),t._v(" "),s("li",[t._v("post")]),t._v(" "),s("li",[t._v("head")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("请求头仅包含安全的字段，常见的安全字段如下：")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("Accept")])]),t._v(" "),s("li",[s("code",[t._v("Accept-Language")])]),t._v(" "),s("li",[s("code",[t._v("Content-Language")])]),t._v(" "),s("li",[s("code",[t._v("Content-Type")])]),t._v(" "),s("li",[s("code",[t._v("DPR")])]),t._v(" "),s("li",[s("code",[t._v("Downlink")])]),t._v(" "),s("li",[s("code",[t._v("Save-Data")])]),t._v(" "),s("li",[s("code",[t._v("Viewport-Width")])]),t._v(" "),s("li",[s("code",[t._v("Width")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("请求头如果包含"),s("code",[t._v("Content-Type")]),t._v("，仅限下面的值之一：")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("text/plain")])]),t._v(" "),s("li",[s("code",[t._v("multipart/form-data")])]),t._v(" "),s("li",[s("code",[t._v("application/x-www-form-urlencoded")])])])])]),t._v(" "),s("p",[t._v("如果以上三个条件同时满足，浏览器判定为简单请求。")]),t._v(" "),s("p",[t._v("下面是一些例子：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 简单请求")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://crossdomain.com/api/news'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 请求方法不满足要求，不是简单请求")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://crossdomain.com/api/news'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("method")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PUT'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 加入了额外的请求头，不是简单请求")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://crossdomain.com/api/news'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("headers")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 简单请求")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://crossdomain.com/api/news'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("method")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'post'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// content-type不满足要求，不是简单请求")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://crossdomain.com/api/news'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("method")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'post'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("headers")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'content-type'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'application/json'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"简单请求的交互规范"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简单请求的交互规范"}},[t._v("#")]),t._v(" 简单请求的交互规范")]),t._v(" "),s("p",[t._v("当浏览器判定某个"),s("strong",[t._v("ajax 跨域请求")]),t._v("是"),s("strong",[t._v("简单请求")]),t._v("时，会发生以下的事情")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("请求头中会自动添加"),s("code",[t._v("Origin")]),t._v("字段")])])]),t._v(" "),s("p",[t._v("比如，在页面"),s("code",[t._v("http://my.com/index.html")]),t._v("中有以下代码造成了跨域")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 简单请求")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://crossdomain.com/api/news'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("请求发出后，请求头会是下面的格式：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("GET /api/news/ HTTP/1.1\nHost: crossdomain.com\nConnection: keep-alive\n...\nReferer: http://my.com/index.html\nOrigin: http://my.com\n")])])]),s("p",[t._v("看到最后一行没，"),s("code",[t._v("Origin")]),t._v("字段会告诉服务器，是哪个源地址在跨域请求")]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[s("strong",[t._v("服务器响应头中应包含"),s("code",[t._v("Access-Control-Allow-Origin")])])])]),t._v(" "),s("p",[t._v("当服务器收到请求后，如果允许该请求跨域访问，需要在响应头中添加"),s("code",[t._v("Access-Control-Allow-Origin")]),t._v("字段")]),t._v(" "),s("p",[t._v("该字段的值可以是：")]),t._v(" "),s("ul",[s("li",[t._v("*：表示我很开放，什么人我都允许访问")]),t._v(" "),s("li",[t._v("具体的源：比如"),s("code",[t._v("http://my.com")]),t._v("，表示我就允许你访问")])]),t._v(" "),s("blockquote",[s("p",[t._v("实际上，这两个值对于客户端"),s("code",[t._v("http://my.com")]),t._v("而言，都一样，因为客户端才不会管其他源服务器允不允许，就关心自己是否被允许")]),t._v(" "),s("p",[t._v("当然，服务器也可以维护一个可被允许的源列表，如果请求的"),s("code",[t._v("Origin")]),t._v("命中该列表，才响应"),s("code",[t._v("*")]),t._v("或具体的源")]),t._v(" "),s("p",[s("strong",[t._v("为了避免后续的麻烦，强烈推荐响应具体的源")])]),t._v(" "),s("hr"),t._v(" "),s("p",[s("em",[t._v("补充：")])]),t._v(" "),s("ol",[s("li",[t._v("服务端直接使用 * 会有问题，哪怕比如每个源请求过去，再响应具体的源，也比直接返回 * 好。")]),t._v(" "),s("li",[t._v("具体的源，例如： "),s("code",[t._v("Access-Control-Allow-Origin: https://m.baidu.com,https://www.baidu.com,http://m.baidu.com,http://www.baidu.com")])])]),t._v(" "),s("hr")]),t._v(" "),s("p",[t._v("假设服务器做出了以下的响应：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("HTTP/1.1 200 OK\nDate: Tue, 21 Apr 2020 08:03:35 GMT\n...\nAccess-Control-Allow-Origin: http://my.com\n...\n\n消息体中的数据\n")])])]),s("p",[t._v("当浏览器看到服务器允许自己访问后，高兴的像一个两百斤的孩子，于是，它就把响应顺利的交给 js，以完成后续的操作")]),t._v(" "),s("p",[t._v("下图简述了整个交互过程")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://mdrs.yuanjin.tech/img/image-20200421162846480.png",alt:"image-20200421162846480"}})]),t._v(" "),s("h2",{attrs:{id:"需要预检的请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#需要预检的请求"}},[t._v("#")]),t._v(" 需要预检的请求")]),t._v(" "),s("p",[t._v("简单的请求对服务器的威胁不大，所以允许使用上述的简单交互即可完成。")]),t._v(" "),s("p",[t._v("但是，如果浏览器不认为这是一种简单请求，就会按照下面的流程进行：")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("浏览器发送预检请求，询问服务器是否允许")])]),t._v(" "),s("li",[s("strong",[t._v("服务器允许")])]),t._v(" "),s("li",[s("strong",[t._v("浏览器发送真实请求")])]),t._v(" "),s("li",[s("strong",[t._v("服务器完成真实的响应")])])]),t._v(" "),s("p",[t._v("比如，在页面"),s("code",[t._v("http://my.com/index.html")]),t._v("中有以下代码造成了跨域")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 需要预检的请求")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://crossdomain.com/api/user'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("method")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// post 请求")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("headers")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置请求头")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("b")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'content-type'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'application/json'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("body")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'袁小进'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("age")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置请求体")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("浏览器发现它不是一个简单请求，则会按照下面的流程与服务器交互")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("浏览器发送预检请求，询问服务器是否允许")])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("OPTIONS /api/user HTTP/1.1\nHost: crossdomain.com\n...\nOrigin: http://my.com\nAccess-Control-Request-Method: POST\nAccess-Control-Request-Headers: a, b, content-type\n")])])]),s("p",[t._v("可以看出，这并非我们想要发出的真实请求，请求中不包含我们的请求头，也没有消息体。")]),t._v(" "),s("p",[t._v("这是一个预检请求，它的目的是询问服务器，是否允许后续的真实请求。")]),t._v(" "),s("p",[t._v("预检请求"),s("strong",[t._v("没有请求体")]),t._v("，它包含了后续真实请求要做的事情")]),t._v(" "),s("p",[t._v("预检请求有以下特征：")]),t._v(" "),s("ul",[s("li",[t._v("请求方法为"),s("code",[t._v("OPTIONS")])]),t._v(" "),s("li",[t._v("没有请求体")]),t._v(" "),s("li",[t._v("请求头中包含\n"),s("ul",[s("li",[s("code",[t._v("Origin")]),t._v("：请求的源，和简单请求的含义一致")]),t._v(" "),s("li",[s("code",[t._v("Access-Control-Request-Method")]),t._v("：后续的真实请求将使用的请求方法")]),t._v(" "),s("li",[s("code",[t._v("Access-Control-Request-Headers")]),t._v("：后续的真实请求会改动的请求头")])])])]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[s("strong",[t._v("服务器允许")])])]),t._v(" "),s("p",[t._v("服务器收到预检请求后，可以检查预检请求中包含的信息，如果允许这样的请求，需要响应下面的消息格式")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("HTTP/1.1 200 OK\nDate: Tue, 21 Apr 2020 08:03:35 GMT\n...\nAccess-Control-Allow-Origin: http://my.com\nAccess-Control-Allow-Methods: POST\nAccess-Control-Allow-Headers: a, b, content-type\nAccess-Control-Max-Age: 86400\n...\n")])])]),s("p",[t._v("对于预检请求，不需要响应任何的消息体，只需要在响应头中添加：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("Access-Control-Allow-Origin")]),t._v("：和简单请求一样，表示允许的源")]),t._v(" "),s("li",[s("code",[t._v("Access-Control-Allow-Methods")]),t._v("：表示允许的后续真实的请求方法")]),t._v(" "),s("li",[s("code",[t._v("Access-Control-Allow-Headers")]),t._v("：表示允许改动的请求头")]),t._v(" "),s("li",[s("code",[t._v("Access-Control-Max-Age")]),t._v("：告诉浏览器，多少秒内，对于同样的请求源、方法、头，都不需要再发送预检请求了（后续请求就不发预检了）")])]),t._v(" "),s("blockquote",[s("ol",[s("li",[s("p",[t._v("如果预检服务器返回的 "),s("code",[t._v("Access-Control-Allow-Methods")]),t._v(" 和 "),s("code",[t._v("Access-Control-Allow-Headers")]),t._v(" 的值和预检的值对不上，也会失败")])]),t._v(" "),s("li",[s("p",[t._v("请求标头首行显示提示 "),s("strong",[s("code",[t._v("Previsional headers are shown")])]),t._v("（显示临时报头），表示请求失败。控制台中，有的预检请求不显示。")])])])]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[s("strong",[t._v("浏览器发送真实请求")])])]),t._v(" "),s("p",[t._v("预检被服务器允许后，浏览器就会发送真实请求了，上面的代码会发生下面的请求数据")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('POST /api/user HTTP/1.1\nHost: crossdomain.com\nConnection: keep-alive\n...\nReferer: http://my.com/index.html\nOrigin: http://my.com\n\n{"name": "袁小进", "age": 18 }\n')])])]),s("ol",{attrs:{start:"4"}},[s("li",[s("strong",[t._v("服务器响应真实请求")])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("HTTP/1.1 200 OK\nDate: Tue, 21 Apr 2020 08:03:35 GMT\n...\nAccess-Control-Allow-Origin: http://my.com\n...\n\n添加用户成功\n")])])]),s("p",[t._v("可以看出，当完成预检之后，后续的处理与简单请求相同")]),t._v(" "),s("p",[t._v("下图简述了整个交互过程")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://mdrs.yuanjin.tech/img/image-20200421165913320.png",alt:"image-20200421165913320"}})]),t._v(" "),s("h2",{attrs:{id:"附带身份凭证的请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#附带身份凭证的请求"}},[t._v("#")]),t._v(" 附带身份凭证的请求")]),t._v(" "),s("p",[t._v("默认情况下，ajax 的跨域请求并不会附带 cookie，这样一来，某些需要权限的操作就无法进行")]),t._v(" "),s("p",[t._v("不过可以通过简单的配置就可以实现附带 cookie")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// xhr")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" xhr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("withCredentials "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// fetch api")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("credentials")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'include'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("这样一来，该跨域的 ajax 请求就是一个"),s("em",[t._v("附带身份凭证的请求")])]),t._v(" "),s("p",[t._v("当一个请求需要附带 cookie 时，无论它是简单请求，还是预检请求，都会在请求头中添加"),s("code",[t._v("cookie")]),t._v("字段")]),t._v(" "),s("p",[t._v("而服务器响应时，需要明确告知客户端：服务器允许这样的凭据")]),t._v(" "),s("p",[t._v("告知的方式也非常的简单，只需要在响应头中添加："),s("code",[t._v("Access-Control-Allow-Credentials: true")]),t._v("即可")]),t._v(" "),s("p",[t._v("对于一个附带身份凭证的请求，若服务器没有明确告知，浏览器仍然视为跨域被拒绝。")]),t._v(" "),s("p",[t._v("另外要特别注意的是："),s("strong",[t._v("对于附带身份凭证的请求，服务器不得设置 "),s("code",[t._v("Access-Control-Allow-Origin 的值为*")])]),t._v("。这就是为什么不推荐使用*的原因")]),t._v(" "),s("blockquote",[s("p",[t._v("（"),s("s",[t._v("我估计是服务器端全局配置了一个 *，或者响应拦截时，在拦截器里面加的 * ，所以简单。不是每个具体方法实现的")]),t._v("）")])]),t._v(" "),s("h2",{attrs:{id:"一个额外的补充"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一个额外的补充"}},[t._v("#")]),t._v(" 一个额外的补充")]),t._v(" "),s("p",[t._v("在跨域访问时，JS 只能拿到一些最基本的响应头，如：Cache-Control、Content-Language、Content-Type、Expires、Last-Modified、Pragma，如果要访问其他头，则需要服务器设置本响应头。")]),t._v(" "),s("p",[s("code",[t._v("Access-Control-Expose-Headers")]),t._v("头让服务器把允许浏览器访问的头放入白名单，例如：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Access-Control-Expose-Headers: authorization, a, b\n")])])]),s("p",[t._v("这样 JS 就能够访问指定的响应头了。")]),t._v(" "),s("h3",{attrs:{id:"聊天机器的人例子"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#聊天机器的人例子"}},[t._v("#")]),t._v(" 聊天机器的人例子：")]),t._v(" "),s("p",[s("code",[t._v("Access-Control-Expose-Headers: authorization")]),t._v(" 服务端定义的响应头，客户端能读取")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token doctype"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),s("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lang")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("en"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("charset")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("UTF-8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("http-equiv")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("X-UA-Compatible"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("IE=edge"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("viewport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("width=device-width, initial-scale=1.0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Document"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}},[s("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://study.duyiedu.com/api/user/login'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("method")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("headers")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'content-type'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'application/json'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("body")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("loginId")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'admin'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("loginPwd")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'123123'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'authorization'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" resp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("json")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n")])])]),s("blockquote",[s("p",[t._v("面试怎么考，一般会问（浏览器）怎么判断简单请求?")]),t._v(" "),s("p",[t._v("先查看是否带身份凭证，ajax 带 "),s("code",[t._v("xhr.withCredentials=true;")]),t._v("，fecth 带 "),s("code",[t._v("credentials:true")]),t._v(" ，再带上 cookie 预检，响应时要加上 "),s("code",[t._v("Access-Control-Allow-Credentials:true")]),t._v("。如果不带判断是否是简单请求，判定成功是简单请求，判定失败就是预检请求，身份凭着请求和预检请求都要两次，一次预检，一次普通请求。")])]),t._v(" "),s("h3",{attrs:{id:"判断请求流程图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#判断请求流程图"}},[t._v("#")]),t._v(" 判断请求流程图")])])}),[],!1,null,null,null);s.default=e.exports}}]);