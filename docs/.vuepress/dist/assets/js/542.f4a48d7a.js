(window.webpackJsonp=window.webpackJsonp||[]).push([[542],{913:function(t,s,a){"use strict";a.r(s);var e=a(10),r=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"loader"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#loader"}},[t._v("#")]),t._v(" loader")]),t._v(" "),s("p",[t._v("这一章学习一个非常重要的概念"),s("em",[t._v("loader")]),t._v(",学习之前回忆下"),s("em",[t._v("webpack")]),t._v("是做什么事？")]),t._v(" "),s("blockquote",[s("p",[t._v("webpack做的事情，仅仅是分析出各种模块的依赖关系，然后形成资源列表，最终打包生成到指定的文件中。\n更多的功能需要借助webpack loaders和webpack plugins完成。")])]),t._v(" "),s("p",[t._v("这节课学习"),s("em",[t._v("loader")]),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"loader是什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#loader是什么"}},[t._v("#")]),t._v(" loader是什么")]),t._v(" "),s("p",[t._v("webpack loader： loader本质上是一个函数，它的作用是将某个源码字符串转换成另一个源码字符串返回。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qwq9527.gitee.io/resource/imgs/2020-01-13-10-39-24.png",alt:""}})]),t._v(" "),s("p",[t._v("loader函数的将在模块解析的过程中被调用，以得到最终的源码。")]),t._v(" "),s("p",[t._v("举个例子：")]),t._v(" "),s("p",[t._v("目前工程的工程这样子")]),t._v(" "),s("div",{staticClass:"language-tex extra-class"},[s("pre",{pre:!0,attrs:{class:"language-tex"}},[s("code",[t._v("├── src\n│   └── index.js\n├── webpack.config.js\n└── package.json\n")])])]),s("p",[s("em",[t._v("webpack.config.js")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("mode")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"development"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("在入口"),s("em",[t._v("index.js")]),t._v("中平时这么写变量的")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("假设我们认为这样写不舒服，下面写法才舒服")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("变量 a"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("这样的代码"),s("em",[t._v("webpack")]),t._v("能打包吗，试一试，控制台报错")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("./src/index.js"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("248")]),t._v(" bytes "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("built"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("failed"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\nERROR "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" ./src/index.js "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(":3\nModule parse failed: Unexpected token "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(":3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nYou may need an appropriate loader to handle this "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#loaders")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" 变量 a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n")])])]),s("p",[t._v("为什么会报错，因为 "),s("em",[t._v("webpack")]),t._v(" 把 "),s("em",[t._v("变量")]),t._v(" 字符当做 "),s("em",[t._v("js")]),t._v(" 解析，不识别。那么这个错误在之前学的流程中哪一步发生的错误呢？需要回顾之前的解析的流程。")]),t._v(" "),s("h2",{attrs:{id:"流程回顾"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#流程回顾"}},[t._v("#")]),t._v(" 流程回顾")]),t._v(" "),s("h3",{attrs:{id:"全流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#全流程"}},[t._v("#")]),t._v(" 全流程")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qwq9527.gitee.io/resource/imgs/2020-01-13-09-28-52.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"chunk中解析模块的流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#chunk中解析模块的流程"}},[t._v("#")]),t._v(" chunk中解析模块的流程")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qwq9527.gitee.io/resource/imgs/2020-01-13-09-29-08.png",alt:""}})]),t._v(" "),s("p",[t._v("错误就是在"),s("strong",[t._v("语法分析")]),t._v("这个流程中出问题的，解析不出来抽象的语法树。"),s("em",[t._v("webpack")]),t._v(" 在打包结果里面抛出了个错误。")]),t._v(" "),s("p",[t._v("假设我们就想用中文方式书写，不想用"),s("code",[t._v("var")]),t._v("，那怎么做呢？")]),t._v(" "),s("p",[s("em",[t._v("webpack")]),t._v(" 自己不做这件事，但是提供一个机制，让你自己处理这件事，这个机制就是"),s("em",[t._v("loader")]),t._v("。")]),t._v(" "),s("p",[s("em",[t._v("loader")]),t._v("本质上就是一个函数，通常将他写成一个个模块。")]),t._v(" "),s("p",[t._v("在这里给工程中添加个目录，添加一个模块"),s("code",[t._v("test-loader.js")]),t._v("，当然目录可以写到任意位置。")]),t._v(" "),s("div",{staticClass:"language-tex extra-class"},[s("pre",{pre:!0,attrs:{class:"language-tex"}},[s("code",[t._v("├── loaders\n│   └── test-loader.js\n├── src\n│   └── index.js\n├── webpack.config.js\n└── package.json\n")])])]),s("p",[s("em",[t._v("test-loader.js")]),t._v(" 导出一个函数，函数接收一个参数"),s("em",[t._v("sourceCode")]),t._v("，返回一个字符串。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("sourceCode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//sourceCode : 变量 a = 1;")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"var a = 1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("这个函数到时会被"),s("em",[t._v("webpack")]),t._v("在打包过程中调用，怎么调用呢？")]),t._v(" "),s("p",[t._v("它将会把源代码作为字符串传入这个函数，然后这个函数返回一个结果，一个新的代码格式。然后把新的代码格式拿去做抽象语法树分析。")]),t._v(" "),s("p",[t._v("这个"),s("em",[t._v("loader")]),t._v("在什么时候运行呢？")]),t._v(" "),s("p",[t._v("在"),s("strong",[t._v("读取文件内容")]),t._v("和"),s("strong",[t._v("抽象语法树分析")]),t._v("之间。")]),t._v(" "),s("p",[t._v("看下面更详细流程")]),t._v(" "),s("h2",{attrs:{id:"chunk中解析模块的更详细流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#chunk中解析模块的更详细流程"}},[t._v("#")]),t._v(" chunk中解析模块的更详细流程：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qwq9527.gitee.io/resource/imgs/2020-01-13-09-35-44.png",alt:""}})]),t._v(" "),s("p",[t._v("那么现在能打包了吗？")]),t._v(" "),s("p",[t._v("还是不行，"),s("em",[t._v("loader")]),t._v("写法没问题了，但是还需要告诉"),s("em",[t._v("webpack")]),t._v("，让"),s("em",[t._v("webpack")]),t._v("知道用这个"),s("em",[t._v("loader")]),t._v("处理这个文件。")]),t._v(" "),s("p",[s("em",[t._v("webpack")]),t._v("是怎么处理"),s("em",[t._v("loaders")]),t._v("呢？看下面处理"),s("em",[t._v("loaders")]),t._v("的流程")]),t._v(" "),s("h2",{attrs:{id:"处理loaders流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#处理loaders流程"}},[t._v("#")]),t._v(" 处理loaders流程：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qwq9527.gitee.io/resource/imgs/2020-01-13-10-29-54.png",alt:""}})]),t._v(" "),s("p",[t._v("这里怎么处理"),s("em",[t._v("loaders")]),t._v("呢？过程也没有那么复杂，它首先判断规则，我这个模块是否满足当前的规则。")]),t._v(" "),s("p",[t._v("比如，当前的模块是"),s("em",[t._v("index.js")]),t._v(",这个模块是否要交给"),s("em",[t._v("loader")]),t._v("处理呢？")]),t._v(" "),s("p",[t._v("它需要做个匹配，看规则中有没有这个模块。也就是说，并不是每个模块都需要经过"),s("em",[t._v("loader")]),t._v("处理。")]),t._v(" "),s("p",[t._v("如果这个模块不需要经过"),s("em",[t._v("loader")]),t._v("处理，那么得到一个"),s("em",[t._v("loader")]),t._v("空数组，空数组一会循环的时候不需要做任何事情，可以认为"),s("em",[t._v("index.js")]),t._v("这个模块不需要任何处理。目前这个模块就是这种情况，直接拿代码去分析，并不知道要交给"),s("em",[t._v("loader")]),t._v("处理，直接拿去进行语法分析。")]),t._v(" "),s("p",[t._v("如果说根据我们的配置，根据这个模块的配置，确实需要"),s("em",[t._v("loader")]),t._v("处理，那么它就会从规则里面，也就是配置里面读取一个"),s("em",[t._v("loader")]),t._v("的数组，配置里面需要写一个"),s("em",[t._v("loader")]),t._v("数组，这个模块要经过哪些"),s("em",[t._v("loader")]),t._v("处理。形成一个"),s("em",[t._v("loaders")]),t._v("数组。")]),t._v(" "),s("p",[t._v("接下来将"),s("em",[t._v("loaders")]),t._v("数组里面，每一个"),s("em",[t._v("loader")]),t._v(",也就是每一个函数，进行处理。怎么处理呢？\n首先将读到的文件内容给它，交个数组里面"),s("strong",[t._v("最后一个"),s("em",[t._v("loader")])]),t._v(",然后这个"),s("em",[t._v("loader")]),t._v("返回一个新的代码，这个新的代码又交给上一个"),s("em",[t._v("loader")]),t._v(",又会产生另一个新的代码，再交给上一个"),s("em",[t._v("loader")]),t._v("，也就是数组的第一个"),s("em",[t._v("loader")]),t._v(",又得到一个新的代码，数组第一个"),s("em",[t._v("loader")]),t._v("得到的最终代码，也就是我们"),s("strong",[t._v("整个的"),s("em",[t._v("loaders")]),t._v("产生的最终源码")]),t._v("。然后再进行抽象语法树分析。")]),t._v(" "),s("p",[t._v("那怎么配置呢？先看完整的配置。")]),t._v(" "),s("h2",{attrs:{id:"loader配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#loader配置"}},[t._v("#")]),t._v(" loader配置：")]),t._v(" "),s("h2",{attrs:{id:"完整配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#完整配置"}},[t._v("#")]),t._v(" "),s("strong",[t._v("完整配置")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("module")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//针对模块的配置，目前版本只有两个配置，rules、noParse")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("rules")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//模块匹配规则，可以存在多个规则")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//每个规则是一个对象")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\.js$")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//匹配的模块正则")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("use")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//匹配到后应用的规则模块")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//其中一个规则")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("loader")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"模块路径"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//loader模块的路径，该字符串会被放置到require中")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("options")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//向对应loader传递的额外参数")]),t._v("\n\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("首先要配置"),s("em",[t._v("module")]),t._v("（模块）。逻辑：对模块进行解析，解析过程中要经过哪些"),s("em",[t._v("loader")]),t._v("。")]),t._v(" "),s("p",[s("em",[t._v("module")]),t._v("：它是一个对象，目前版本只有两个配置，"),s("em",[t._v("rules")]),t._v("、"),s("em",[t._v("noParse")])]),t._v(" "),s("ul",[s("li",[t._v("一个是 "),s("em",[t._v("rules")]),t._v("，它是一个数组，表示模块匹配的规则，规则对应图中"),s("strong",[t._v("当前模块是否满足某个规则")]),t._v("。")]),t._v(" "),s("li",[t._v("另一个是 "),s("em",[t._v("noParse")]),t._v("，表示是否不要解析某个模块。现在不管。")])]),t._v(" "),s("p",[s("em",[t._v("rules")]),t._v("：再回到"),s("em",[t._v("rules")]),t._v(",可以配置很多规则，比如"),s("em",[t._v("规则1")]),t._v("，"),s("em",[t._v("规则2")]),t._v("，那么匹配的话从"),s("em",[t._v("规则2")]),t._v("开始匹配，然后再匹配"),s("em",[t._v("规则1")]),t._v("。")]),t._v(" "),s("p",[s("em",[t._v("每一个规则")]),t._v("：每个规则就是一个对象，规则里面有什么呢？规则里面就要去匹配了。")]),t._v(" "),s("ul",[s("li",[s("em",[t._v("test")]),t._v("：首先里面有"),s("em",[t._v("test")]),t._v("，表示正则表达式，匹配模块的路径。\n匹配到了怎么办呢？要告诉它要用哪些加载器，对应图中"),s("strong",[t._v("读取规则中对应的loaders")]),t._v("。")]),t._v(" "),s("li",[s("em",[t._v("use")]),t._v("：规则另一个属性"),s("em",[t._v("use")]),t._v(",是一个数组，表示匹配到了之后，使用哪些加载器。\n"),s("ul",[s("li",[s("em",[t._v("每个加载器")]),t._v("：每个加载器就是一个对象。加载器的对象包含呢些呢？\n"),s("ul",[s("li",[t._v("首先是"),s("em",[t._v("loader")]),t._v("属性，表示加载器的路径。这个路径到时候怎么将对应的"),s("em",[t._v("loader")]),t._v("加载出来呢？\n到时候"),s("em",[t._v("webpack")]),t._v("内部会自动使用"),s("em",[t._v("require")]),t._v("函数"),s("code",[t._v('require("./loaders/test-loader")')]),t._v("，将对应"),s("em",[t._v("loader")]),t._v("加载出来。")])])])])])]),t._v(" "),s("p",[t._v("例中的配置加上"),s("em",[t._v("module")]),t._v("配置后")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("mode")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"development"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("module")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("rules")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v(".\\.js")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("use")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("loader")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./loaders/test-loader.js"')]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("现在运行就正常了。")]),t._v(" "),s("p",[t._v("再来看，将"),s("em",[t._v("test-loader.js")]),t._v("修改一下")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("sourceCode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//sourceCode : 变量 a = 1;")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" sourceCode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("变量")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-flags"}},[t._v("g")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'var'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("源码"),s("em",[t._v("index.js")]),t._v("修改下")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("变量 a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n变量 b "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("打包结果：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("eval")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"var a = 1;\\nvar b = 2;\\n\\n\\n//# sourceURL=webpack:///./src/index.js?"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//...")]),t._v("\n")])])]),s("p",[t._v("输出正确。再来看，"),s("em",[t._v("loader")]),t._v("运行时还可以给一些额外的信息。")]),t._v(" "),s("p",[t._v("比如说，"),s("em",[t._v("test-loader.js")]),t._v("中，不一定改变“变量”这个值，要改变另外的值，比如说将“未知数”变成"),s("code",[t._v("var")]),t._v("。")]),t._v(" "),s("p",[t._v("那么可以在配置中这么写")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("mode")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"development"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("module")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("rules")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v(".\\.js")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("use")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("loader")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./loaders/test-loader.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("options")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                            "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("changeVar")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"未知数"')]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("这里每个配置的"),s("em",[t._v("loader")]),t._v("都可以给参数，通过"),s("em",[t._v("options")]),t._v("提供参数，"),s("em",[t._v("options")]),t._v("里面键值对是自行规定的。\n"),s("em",[t._v("test-loader.js")]),t._v("就可以不使用固定的写法将 "),s("em",[t._v("“变量”")]),t._v(" 变成"),s("code",[t._v("var")]),t._v("了，而是可以将传过来的东西变成 "),s("code",[t._v("var")]),t._v("。\n那么怎么获取"),s("em",[t._v("options")]),t._v("内容呢？这里要说下，通过"),s("em",[t._v("loader")]),t._v("，也就是函数，它的参数是获取不到的，要在"),s("em",[t._v("this")]),t._v("里面获取。\n在运行"),s("em",[t._v("loader")]),t._v("函数时，要绑定上下文，在"),s("em",[t._v("webpack")]),t._v("打包的时候会形成一个上下文对象，这个对象包含了很多东西。里面就包含了"),s("em",[t._v("loaders")]),t._v("属性，譬如"),s("code",[t._v("this.loaders")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'E:\\\\duyi\\\\源码\\\\frontend-webpack-particular-master\\\\1. webpack核心功能\\\\1-11. loader\\\\loaders\\\\test-loader.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("        \n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("query")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'??ref--4-0'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("options")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("changeVar")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'未知数'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("ident")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ref--4-0'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("normal")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Function"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("pitch")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("raw")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("pitchExecuted")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("normalExecuted")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("request")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Getter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Setter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("这样就能获取 "),s("em",[t._v("options")]),t._v("，但是很不方便，因此有个第三方库，"),s("code",[t._v("loader-utils")]),t._v(" "),s("em",[t._v("loader")]),t._v(" 的工具包，可以使用它。\n里面提供了"),s("code",[t._v("getOptions")]),t._v("方法来获取"),s("em",[t._v("options")]),t._v("。")]),t._v(" "),s("p",[s("em",[t._v("test-loader.js")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" loaderUtils "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"loader-utils"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("sourceCode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// console.log(this.loaders);")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" options "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" loaderUtils"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getOptions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" reg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RegExp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("changeVar"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'g'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" sourceCode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'var'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("em",[t._v("index.js")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("未知数 a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n未知数 b "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("打包结果：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/***/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("eval")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"var a = 1;\\nvar b = 2;\\n\\n\\n//# sourceURL=webpack:///./src/index.js?"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/***/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("通过"),s("em",[t._v("options")]),t._v("配置，我们的加载器就更加的灵活了，高度可配。就不需要为不同的环境都写一个"),s("em",[t._v("loader")]),t._v("了，就可以把某些功能相似的"),s("em",[t._v("loader")]),t._v("通过参数来配置。")]),t._v(" "),s("p",[t._v("参数除了在"),s("em",[t._v("options")]),t._v("里面进行配置，还可以通过"),s("em",[t._v("query")]),t._v("方式，也就地址栏传参这种方式配置。其实就是一种格式,也在"),s("code",[t._v("this.loaders")]),t._v("属性中，想怎么读取都可以，只不过这是一种习惯，简单的参数写到这里也可以。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("mode")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"development"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("module")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("rules")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v(".\\.js")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("use")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("loader")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./loaders/test-loader.js?changeVar=未知数"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("code",[t._v("loader-util")]),t._v("也可读出来。")]),t._v(" "),s("p",[t._v("如果说配置"),s("em",[t._v("loader")]),t._v("的时候只有一个键值对，"),s("code",[t._v("loader:字符串")]),t._v("，那么配置就可以简化，没有必要写成完整的对象。")]),t._v(" "),s("p",[t._v("直接把字符串作为数组的一项即可，看上去更加简洁。看下面的简化配置")]),t._v(" "),s("h2",{attrs:{id:"简化配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简化配置"}},[t._v("#")]),t._v(" 简化配置")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("module")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//针对模块的配置，目前版本只有两个配置，rules、noParse")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("rules")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//模块匹配规则，可以存在多个规则")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//每个规则是一个对象")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\.js$")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//匹配的模块正则")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("use")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"模块路径1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"模块路径2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//loader模块的路径，该字符串会被放置到require中")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("读一遍：\n对模块的配置，模块里有两个配置，另一个配置以后再说，其中一个配置是"),s("em",[t._v("规则")]),t._v("，就是用来怎么来匹配这个模块，匹配到了我要用的哪些加载器。\n每个规则里面都有一个正则表达式来匹配模块的路径，匹配到了看它要应用哪些"),s("em",[t._v("loader")]),t._v("来处理源代码。")]),t._v(" "),s("h2",{attrs:{id:"例子"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#例子"}},[t._v("#")]),t._v(" 例子")]),t._v(" "),s("h3",{attrs:{id:"多个loader"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#多个loader"}},[t._v("#")]),t._v(" 多个loader")]),t._v(" "),s("p",[t._v("再举下多个规则，多个"),s("em",[t._v("loader")]),t._v("的例子")]),t._v(" "),s("div",{staticClass:"language-tex extra-class"},[s("pre",{pre:!0,attrs:{class:"language-tex"}},[s("code",[t._v("├── loaders\n│\t├── loader1.js // 内容:console.log(1)\n│\t├── loader2.js // 内容:console.log(2)\n│\t├── loader3.js // 内容:console.log(3)\n│   └── loader4.js // 内容:console.log(4)\n├── src\n│   └── index.js // 里面没内容\n├── webpack.config.js\n└── package.json\n")])])]),s("p",[s("em",[t._v("wepack.config.js")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("mode")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"development"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("module")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("rules")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("index\\.js")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("use")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./loaders/loader1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./loaders/loader2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\.js")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("use")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./loaders/loader3"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./loaders/loader4"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("执行"),s("code",[t._v("npx webpack")]),t._v(",控制台输出")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("loader4\nloader3\nloader2\nloader1\nHash: 5b90c629ada6fed12c59\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),s("p",[t._v("分析：结果和我们写的相反，实际上："),s("strong",[t._v("规则匹配的时候是从上往下，但是运行的时候是相反的")]),t._v("。\n它是这样做的：\n可以这样理解，一开始有一个空数组"),s("code",[t._v("[]")]),t._v(",\n第一次匹配拿到一个数组："),s("code",[t._v('["./loaders/loader1","./loaders/loader2"]')]),t._v(",\n然后将数组对应的"),s("em",[t._v("loader")]),t._v("函数都放到空数组中，"),s("code",[t._v("[loader1,loader2]")]),t._v("\n然后匹配第二个规则，第二次也拿到一个数组："),s("code",[t._v('["./loaders/loader3","./loaders/loader4"]')]),t._v("。然后把数组对应的"),s("em",[t._v("loader")]),t._v("函数追加进去。\n变成"),s("code",[t._v("[loader1,loader2,loader3,loader4]")]),t._v(",每个"),s("em",[t._v("loader")]),t._v("都是一个函数。怎么使用呢？\n用的时候是反向的，它先将内容交给4，4返回的内容交给3，3返回内容交给2，2交给1。\n"),s("em",[t._v("loader1")]),t._v("最终得到源码，再进行语法分析。")]),t._v(" "),s("h3",{attrs:{id:"输出结果是啥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#输出结果是啥"}},[t._v("#")]),t._v(" 输出结果是啥")]),t._v(" "),s("p",[t._v("将上个例子改动下，请问：打包后"),s("em",[t._v("loader")]),t._v("输出的顺序？")]),t._v(" "),s("div",{staticClass:"language-tex extra-class"},[s("pre",{pre:!0,attrs:{class:"language-tex"}},[s("code",[t._v('## 改动部分\n├── src\n│   ├── a.js // 里面没内容\n│   └── index.js // 内容：require("./a")\n## 改动部分\n')])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("loader4,loader3,loader2,loader1,loader4,loader3\n")])])]),s("p",[t._v("分析：这要根据两张图 "),s("a",{attrs:{href:"#chunk%E4%B8%AD%E8%A7%A3%E6%9E%90%E6%A8%A1%E5%9D%97%E7%9A%84%E6%9B%B4%E8%AF%A6%E7%BB%86%E6%B5%81%E7%A8%8B"}},[t._v("chunk中解析模块的更详细流程")]),t._v("和 "),s("a",{attrs:{href:"#%E5%A4%84%E7%90%86loaders%E6%B5%81%E7%A8%8B"}},[t._v("处理loaders流程")])]),t._v(" "),s("p",[s("em",[t._v("index.js")]),t._v("模块先进行解析流程，到了"),s("strong",[t._v("处理loaders")]),t._v("流程中匹配到4个"),s("em",[t._v("loader")]),t._v("，然后后输入"),s("code",[t._v("loader4,loader3,loader2,loader1")]),t._v("。")]),t._v(" "),s("p",[t._v("再到后面流程中收集到了"),s("em",[t._v("a.js")]),t._v("模块的依赖，"),s("em",[t._v("index.js")]),t._v("模块处理完后，再处理依赖中的"),s("em",[t._v("a.js")]),t._v("模块，"),s("em",[t._v("a.js")]),t._v("模块到了"),s("strong",[t._v("处理loaders")]),t._v("流程中匹配到2个"),s("em",[t._v("loader")]),t._v("，然后后输入"),s("code",[t._v("loader4,loader3")]),t._v("。")])])}),[],!1,null,null,null);s.default=r.exports}}]);