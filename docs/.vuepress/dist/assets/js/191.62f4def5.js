(window.webpackJsonp=window.webpackJsonp||[]).push([[191],{562:function(t,a,s){"use strict";s.r(a);var r=s(10),n=Object(r.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"文件上传"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件上传"}},[t._v("#")]),t._v(" 文件上传")]),t._v(" "),a("h2",{attrs:{id:"文件上传的消息格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件上传的消息格式"}},[t._v("#")]),t._v(" 文件上传的消息格式")]),t._v(" "),a("p",[t._v("文件上传的本质仍然是一个数据提交，无非就是数据量大一些而已")]),t._v(" "),a("p",[t._v("在实践中，人们逐渐的形成了一种共识，我们自行规定，文件上传默认使用下面的请求格式")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('POST 上传地址 HTTP/1.1\n其他请求头\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW\n\n----WebKitFormBoundary7MA4YWxkTrZu0gW\nContent-Disposition: form-data; name="avatar"; filename="小仙女.jpg"\nContent-Type: image/jpeg\n\n(文件二进制数据)\n----WebKitFormBoundary7MA4YWxkTrZu0gW\nContent-Disposition: form-data; name="username"\n\nadmin\n----WebKitFormBoundary7MA4YWxkTrZu0gW\nContent-Disposition: form-data; name="password"\n\n123123\n----WebKitFormBoundary7MA4YWxkTrZu0gW\n')])])]),a("ul",[a("li",[t._v("除非接口文档特别说明，文件上传一般使用POST请求")]),t._v(" "),a("li",[t._v("接口文档中会规定上传地址，一般一个站点会有一个统一的上传地址")]),t._v(" "),a("li",[t._v("除非接口文档特别说明，"),a("code",[t._v("content-type: multipart/form-data")]),t._v("，浏览器会自动分配一个定界符"),a("code",[t._v("boundary")])]),t._v(" "),a("li",[t._v("请求体的格式是一个被定界符"),a("code",[t._v("boundary")]),t._v("分割的消息，每个分割区域本质就是一个键值对")]),t._v(" "),a("li",[t._v("除了键值对外，"),a("code",[t._v("multipart/form-data")]),t._v("允许添加其他额外信息，比如文件数据区域，一般会把文件在本地的名称和文件MIME类型告诉服务器")])]),t._v(" "),a("h2",{attrs:{id:"文件上传的实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件上传的实现"}},[t._v("#")]),t._v(" 文件上传的实现")]),t._v(" "),a("p",[t._v("在现代的网页交互中，带表单的文件上传通常使用下面的方式实现")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://mdrs.yuanjin.tech/img/20210917132919.png",alt:"文件上传逻辑"}})]),t._v(" "),a("blockquote",[a("p",[t._v("后端开发服务器：http://localhost:8000")])]),t._v(" "),a("h2",{attrs:{id:"接口示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#接口示例"}},[t._v("#")]),t._v(" 接口示例")]),t._v(" "),a("h3",{attrs:{id:"统一上传接口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#统一上传接口"}},[t._v("#")]),t._v(" 统一上传接口")]),t._v(" "),a("p",[a("strong",[t._v("请求路径")]),t._v("：/api/upload")]),t._v(" "),a("p",[a("strong",[t._v("请求方法")]),t._v("：POST")]),t._v(" "),a("p",[a("strong",[t._v("字段名")]),t._v("：file")]),t._v(" "),a("p",[a("strong",[t._v("尺寸限制")]),t._v("：1M")]),t._v(" "),a("p",[a("strong",[t._v("支持的文件后缀")]),t._v("：.jpg, .jpeg, .gif, .png, .bmp, .webp")]),t._v(" "),a("p",[a("strong",[t._v("上传成功的响应")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("code")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("msg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://localhost:8000/upload/a32d18.jpg'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 访问路径")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("strong",[t._v("可能发生的失败响应")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("code")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("403")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("msg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'文件超过了限制'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("code")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("403")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("msg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'无效的文件类型'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"用户注册接口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用户注册接口"}},[t._v("#")]),t._v(" 用户注册接口")]),t._v(" "),a("p",[a("strong",[t._v("请求路径")]),t._v("：/api/user/reg")]),t._v(" "),a("p",[a("strong",[t._v("请求方法")]),t._v("：POST")]),t._v(" "),a("p",[a("strong",[t._v("支持消息类型")]),t._v("：")]),t._v(" "),a("ol",[a("li",[t._v("x-www-form-urlencoded")]),t._v(" "),a("li",[t._v("json")])]),t._v(" "),a("p",[a("strong",[t._v("字段")]),t._v("：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("字段名")]),t._v(" "),a("th",[t._v("含义")]),t._v(" "),a("th",[t._v("是否必须")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("username")]),t._v(" "),a("td",[t._v("账号")]),t._v(" "),a("td",[t._v("是")])]),t._v(" "),a("tr",[a("td",[t._v("password")]),t._v(" "),a("td",[t._v("密码")]),t._v(" "),a("td",[t._v("是")])]),t._v(" "),a("tr",[a("td",[t._v("avatar")]),t._v(" "),a("td",[t._v("头像")]),t._v(" "),a("td",[t._v("是")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td"),t._v(" "),a("td")])])]),t._v(" "),a("p",[a("strong",[t._v("注册成功的响应")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("code")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("msg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("username")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'monica'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("avatar")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://localhost:8000/upload/a234wq1.jpg'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);